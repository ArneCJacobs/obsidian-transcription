/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => Transcription
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/transcribe.ts
var import_obsidian2 = require("obsidian");

// src/utils.ts
var import_obsidian = require("obsidian");
var randomString = (length) => Array(length + 1).join((Math.random().toString(36) + "00000000000000000").slice(2, 18)).slice(0, length);
async function payloadGenerator(payload_data) {
  const boundary_string = `Boundary${randomString(16)}`;
  const boundary = `------${boundary_string}`;
  const chunks = [];
  for (const [key, value] of Object.entries(payload_data)) {
    chunks.push(new TextEncoder().encode(`${boundary}\r
`));
    if (typeof value === "string") {
      chunks.push(new TextEncoder().encode(`Content-Disposition: form-data; name="${key}"\r
\r
`));
      chunks.push(new TextEncoder().encode(`${value}\r
`));
    } else if (value instanceof Blob) {
      chunks.push(new TextEncoder().encode(`Content-Disposition: form-data; name="${key}"; filename="blob"\r
Content-Type: "application/octet-stream"\r
\r
`));
      chunks.push(await (0, import_obsidian.getBlobArrayBuffer)(value));
      chunks.push(new TextEncoder().encode("\r\n"));
    } else {
      chunks.push(new Uint8Array(await new Response(value).arrayBuffer()));
      chunks.push(new TextEncoder().encode("\r\n"));
    }
  }
  await Promise.all(chunks);
  chunks.push(new TextEncoder().encode(`${boundary}--\r
`));
  return [await new Blob(chunks).arrayBuffer(), boundary_string];
}

// src/transcribe.ts
var TranscriptionEngine = class {
  constructor(settings, vault) {
    this.transcription_engines = {
      "scribe": this.getTranscriptionScribe,
      "whisper_asr": this.getTranscriptionWhisperASR
    };
    this.settings = settings;
    this.vault = vault;
  }
  segmentsToTimestampedString(segments) {
    var transcription = "";
    const duration_seconds = Math.floor(segments[segments.length - 1].end);
    var start_iso_slice = 14;
    if (duration_seconds >= 3600)
      start_iso_slice = 11;
    for (var s of segments) {
      if (typeof s.start === "number" && typeof s.text === "string") {
        const start = new Date(Math.floor(s.start) * 1e3).toISOString().substring(start_iso_slice, 19);
        const end = new Date(Math.floor(s.end) * 1e3).toISOString().substring(start_iso_slice, 19);
        const timestamp = `\`[${start} - ${end}]\``;
        transcription += timestamp + ": " + s.text + "\n";
      } else {
        if (this.settings.debug)
          console.error(`Invalid segment: ${s}`);
      }
    }
    return transcription;
  }
  async getTranscription(file) {
    if (this.settings.debug)
      console.log(`Transcription engine: ${this.settings.transcription_engine}`);
    this.transcription_engine = this.transcription_engines[this.settings.transcription_engine];
    return this.transcription_engine(file);
  }
  async getTranscriptionWhisperASR(file) {
    let payload_data = {};
    payload_data["audio_file"] = new Blob([await this.vault.readBinary(file)]);
    ;
    const [request_body, boundary_string] = await payloadGenerator(payload_data);
    const options = {
      method: "POST",
      url: `${this.settings.whisperASRUrl}/asr?task=transcribe&language=en`,
      contentType: `multipart/form-data; boundary=----${boundary_string}`,
      body: request_body
    };
    return (0, import_obsidian2.requestUrl)(options).then(async (response) => {
      if (this.settings.debug)
        console.log(response);
      if (this.settings.timestamps)
        return this.segmentsToTimestampedString(response.json.segments);
      else {
        const transcription = response.json.text;
        return transcription;
      }
    }).catch((error) => {
      if (this.settings.debug)
        console.error(error);
      return Promise.reject(error);
    });
  }
  async getTranscriptionScribe(file) {
    let api_base;
    if (this.settings.debug)
      api_base = "https://dev.api.gambitengine.com";
    else
      api_base = "https://api.gambitengine.com";
    const create_transcription_request = {
      method: "POST",
      url: `${api_base}/v1/scribe/transcriptions`,
      headers: { "Authorization": `Bearer ${this.settings.scribeToken}` },
      body: JSON.stringify({ "translate": this.settings.translate })
    };
    if (this.settings.debug)
      console.log("Transcribing with Scribe");
    return (0, import_obsidian2.requestUrl)(create_transcription_request).then(async (response) => {
      const create_transcription_response = response.json;
      if (this.settings.debug)
        console.log(create_transcription_response);
      if (this.settings.debug)
        console.log("Uploading file to Scribe S3...");
      if (create_transcription_response.upload_request === void 0 || create_transcription_response.upload_request.url === void 0 || create_transcription_response.upload_request.fields === void 0) {
        if (this.settings.debug)
          console.error("Scribe returned an invalid upload request");
        return Promise.reject("Scribe returned an invalid upload request");
      }
      let payload_data = {};
      for (const [key, value] of Object.entries(create_transcription_response.upload_request.fields)) {
        if (typeof key === "string" && typeof value === "string")
          payload_data[key] = value;
        else {
          if (this.settings.debug)
            console.error("Scribe returned an invalid upload request");
          return Promise.reject("Scribe returned an invalid upload request");
        }
      }
      payload_data["file"] = new Blob([await this.vault.readBinary(file)]);
      ;
      const [request_body, boundary_string] = await payloadGenerator(payload_data);
      const upload_file_request = {
        method: "POST",
        url: create_transcription_response.upload_request.url,
        contentType: `multipart/form-data; boundary=----${boundary_string}`,
        body: request_body
      };
      return (0, import_obsidian2.requestUrl)(upload_file_request).then(async (response2) => {
        if (this.settings.debug)
          console.log("File uploaded to Scribe S3");
        const get_transcription_request = {
          method: "GET",
          url: `${api_base}/v1/scribe/transcriptions/${create_transcription_response.transcription.transcription_id}`,
          headers: { "Authorization": `Bearer ${this.settings.scribeToken}` }
        };
        if (this.settings.debug)
          console.log("Waiting for Scribe to finish transcribing...");
        let tries = 0;
        while (true) {
          const get_transcription_response = await (0, import_obsidian2.requestUrl)(get_transcription_request).json;
          if (this.settings.debug)
            console.log(get_transcription_response);
          if (get_transcription_response.status == "complete" && get_transcription_response.transcription_text !== void 0 && get_transcription_response.transcription_result !== void 0) {
            if (this.settings.debug)
              console.log("Scribe finished transcribing");
            if (this.settings.timestamps)
              return this.segmentsToTimestampedString(get_transcription_response.transcription_result);
            else
              return get_transcription_response.transcription_text;
          } else if (tries > 60) {
            if (this.settings.debug)
              console.error("Scribe took too long to transcribe the file");
            return Promise.reject("Scribe took too long to transcribe the file");
          } else if (get_transcription_response.status == "failed") {
            if (this.settings.debug)
              console.error("Scribe failed to transcribe the file");
            return Promise.reject("Scribe failed to transcribe the file");
          } else if (get_transcription_response.status == "validation_failed") {
            if (this.settings.debug)
              console.error("Scribe has detected an invalid file");
            return Promise.reject("Scribe has detected an invalid file");
          } else {
            tries += 1;
            await sleep(3e3);
          }
        }
      }).catch((error) => {
        if (this.settings.debug)
          console.error(error);
        return Promise.reject(error);
      });
    }).catch((error) => {
      if (this.settings.debug)
        console.error(error);
      return Promise.reject(error);
    });
  }
};

// src/main.ts
var DEFAULT_SETTINGS = {
  timestamps: false,
  translate: false,
  transcribeFileExtensions: ["mp3", "wav", "webm", "ogg", "flac", "m4a", "aac", "amr", "opus", "aiff", "m3gp", "mp4", "m4v", "mov", "avi", "wmv", "flv", "mpeg", "mpg", "mkv"],
  whisperASRUrl: "http://localhost:9000",
  debug: false,
  scribeToken: "",
  transcription_engine: "Scribe"
};
var _Transcription = class extends import_obsidian3.Plugin {
  async onload() {
    await this.loadSettings();
    _Transcription.plugin = this;
    console.log("Loading Obsidian Transcription");
    this.transcription_engine = new TranscriptionEngine(this.settings, this.app.vault);
    this.addCommand({
      id: "obsidian-transcription-transcribe-all-in-view",
      name: "Transcribe all audio files in view",
      editorCallback: async (editor, view) => {
        const markdownFilePath = view.file.path;
        if (this.settings.debug)
          console.log("Transcribing all audio files in " + markdownFilePath);
        new import_obsidian3.Notice("Transcribing all audio files in " + view.file.name, 3e3);
        const filesLinked = Object.keys(this.app.metadataCache.resolvedLinks[markdownFilePath]);
        console.log(this.app.metadataCache);
        const filesToTranscribe = [];
        for (const linkedFilePath of filesLinked) {
          const linkedFileExtension = linkedFilePath.split(".").pop();
          if (linkedFileExtension === void 0 || !this.settings.transcribeFileExtensions.includes(linkedFileExtension.toLowerCase())) {
            if (this.settings.debug)
              console.log("Skipping " + linkedFilePath + " because the file extension is not in the list of transcribeable file extensions");
            continue;
          }
          const linkedFile = this.app.vault.getAbstractFileByPath(linkedFilePath);
          if (linkedFile instanceof import_obsidian3.TFile)
            filesToTranscribe.push(linkedFile);
          else {
            if (this.settings.debug)
              console.log("Could not find file " + linkedFilePath);
            continue;
          }
        }
        for (const fileToTranscribe of filesToTranscribe) {
          if (this.settings.debug)
            console.log("Transcribing " + fileToTranscribe.path);
          this.transcription_engine.getTranscription(fileToTranscribe).then(async (transcription) => {
            if (this.settings.debug)
              console.log(transcription);
            var fileText = await this.app.vault.read(view.file);
            const fileLinkString = this.app.metadataCache.fileToLinktext(fileToTranscribe, view.file.path);
            const fileLinkStringTagged = `[[${fileLinkString}]]`;
            console.log(fileLinkString);
            const startReplacementIndex = fileText.indexOf(fileLinkStringTagged) + fileLinkStringTagged.length;
            fileText = [fileText.slice(0, startReplacementIndex), `
${transcription}`, fileText.slice(startReplacementIndex)].join("");
            await this.app.vault.modify(view.file, fileText);
          }).catch((error) => {
            if (this.settings.debug)
              new import_obsidian3.Notice("Error transcribing file " + fileToTranscribe.name + ": " + error);
            else
              new import_obsidian3.Notice("Error transcribing file, enable debug mode to see more");
          });
        }
      }
    });
    this.app.workspace.on("quit", () => {
      _Transcription.children.forEach((child) => {
        child.kill();
      });
    });
    this.addSettingTab(new TranscriptionSettingTab(this.app, this));
  }
  onunload() {
    if (this.settings.debug)
      console.log("Unloading Obsidian Transcription");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var Transcription = _Transcription;
Transcription.children = [];
var TranscriptionSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Settings for Obsidian Transcription" });
    new import_obsidian3.Setting(containerEl).setName("General Settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Transcription engine").setDesc("The transcription engine to use").setTooltip("Scribe is a cloud based transcription engine offered by GambitEngine (no set up, mobile friendly). Whisper ASR is a self-hosted local transcription engine that uses the Whisper ASR python app. (requires separate set up, not mobile friendly)").setClass("transcription-engine-setting").addDropdown((dropdown) => dropdown.addOption("scribe", "Scribe").addOption("whisper_asr", "Whisper ASR").setValue(this.plugin.settings.transcription_engine).onChange(async (value) => {
      this.plugin.settings.transcription_engine = value;
      await this.plugin.saveSettings();
      if (value == "scribe") {
        containerEl.findAll(".scribe-settings").forEach((element) => {
          element.style.display = "block";
        });
        containerEl.findAll(".whisper-asr-settings").forEach((element) => {
          element.style.display = "none";
        });
      } else if (value == "whisper_asr") {
        containerEl.findAll(".scribe-settings").forEach((element) => {
          element.style.display = "none";
        });
        containerEl.findAll(".whisper-asr-settings").forEach((element) => {
          element.style.display = "block";
        });
      }
    }));
    new import_obsidian3.Setting(containerEl).setName("Enable timestamps").setDesc("Add timestamps to the beginning of each line").addToggle((toggle) => toggle.setValue(this.plugin.settings.timestamps).onChange(async (value) => {
      this.plugin.settings.timestamps = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Scribe Settings").setClass("scribe-settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Enable translation").setDesc("Translate the transcription from any language to English").setClass("scribe-settings").addToggle((toggle) => toggle.setValue(this.plugin.settings.translate).onChange(async (value) => {
      this.plugin.settings.translate = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Scribe Token").setDesc("The token used to authenticate with the Scribe API. Get one at https://scribe.gambitengine.com").setClass("scribe-settings").addText((text) => text.setPlaceholder(DEFAULT_SETTINGS.scribeToken).setValue(this.plugin.settings.scribeToken).onChange(async (value) => {
      this.plugin.settings.scribeToken = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Whisper ASR Settings").setClass("whisper-asr-settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Whisper ASR URL").setDesc("The URL of the Whisper ASR server: https://github.com/ahmetoner/whisper-asr-webservice").setClass("whisper-asr-settings").addText((text) => text.setPlaceholder(DEFAULT_SETTINGS.whisperASRUrl).setValue(this.plugin.settings.whisperASRUrl).onChange(async (value) => {
      this.plugin.settings.whisperASRUrl = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Advanced Settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Debug mode").setDesc("Enable debug mode to see more console logs").addToggle((toggle) => toggle.setValue(this.plugin.settings.debug).onChange(async (value) => {
      this.plugin.settings.debug = value;
      await this.plugin.saveSettings();
    }));
    if (this.plugin.settings.transcription_engine == "scribe") {
      containerEl.findAll(".scribe-settings").forEach((element) => {
        element.style.display = "block";
      });
      containerEl.findAll(".whisper-asr-settings").forEach((element) => {
        element.style.display = "none";
      });
    } else if (this.plugin.settings.transcription_engine == "whisper_asr") {
      containerEl.findAll(".scribe-settings").forEach((element) => {
        element.style.display = "none";
      });
      containerEl.findAll(".whisper-asr-settings").forEach((element) => {
        element.style.display = "block";
      });
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3RyYW5zY3JpYmUudHMiLCAic3JjL3V0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBDaGlsZFByb2Nlc3MgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IEFwcCwgRWRpdG9yLCBNYXJrZG93blZpZXcsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25FbmdpbmUgfSBmcm9tICdzcmMvdHJhbnNjcmliZSc7XG5cbmludGVyZmFjZSBUcmFuc2NyaXB0aW9uU2V0dGluZ3Mge1xuXHR0aW1lc3RhbXBzOiBib29sZWFuO1xuXHR0cmFuc2xhdGU6IGJvb2xlYW47XG5cdHRyYW5zY3JpYmVGaWxlRXh0ZW5zaW9uczogc3RyaW5nW107XG5cdHdoaXNwZXJBU1JVcmw6IHN0cmluZztcblx0ZGVidWc6IGJvb2xlYW47XG5cdHNjcmliZVRva2VuOiBzdHJpbmc7XG5cdHRyYW5zY3JpcHRpb25fZW5naW5lOiBzdHJpbmdcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogVHJhbnNjcmlwdGlvblNldHRpbmdzID0ge1xuXHR0aW1lc3RhbXBzOiBmYWxzZSxcblx0dHJhbnNsYXRlOiBmYWxzZSxcblx0dHJhbnNjcmliZUZpbGVFeHRlbnNpb25zOiBbJ21wMycsICd3YXYnLCAnd2VibScsICdvZ2cnLCAnZmxhYycsICdtNGEnLCAnYWFjJywgJ2FtcicsICdvcHVzJywgJ2FpZmYnLCAnbTNncCcsICdtcDQnLCAnbTR2JywgJ21vdicsICdhdmknLCAnd212JywgJ2ZsdicsICdtcGVnJywgJ21wZycsICdta3YnXSxcblx0d2hpc3BlckFTUlVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6OTAwMCcsXG5cdGRlYnVnOiBmYWxzZSxcblx0c2NyaWJlVG9rZW46ICcnLFxuXHR0cmFuc2NyaXB0aW9uX2VuZ2luZTogJ1NjcmliZSdcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNjcmlwdGlvbiBleHRlbmRzIFBsdWdpbiB7XG5cblx0c2V0dGluZ3M6IFRyYW5zY3JpcHRpb25TZXR0aW5ncztcblx0cHVibGljIHN0YXRpYyBwbHVnaW46IFBsdWdpbjtcblx0cHVibGljIHN0YXRpYyBjaGlsZHJlbjogQXJyYXk8Q2hpbGRQcm9jZXNzPiA9IFtdO1xuXHRwdWJsaWMgdHJhbnNjcmlwdGlvbl9lbmdpbmU6IFRyYW5zY3JpcHRpb25FbmdpbmU7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cdFx0VHJhbnNjcmlwdGlvbi5wbHVnaW4gPSB0aGlzO1xuXHRcdGNvbnNvbGUubG9nKCdMb2FkaW5nIE9ic2lkaWFuIFRyYW5zY3JpcHRpb24nKTtcblx0XHR0aGlzLnRyYW5zY3JpcHRpb25fZW5naW5lID0gbmV3IFRyYW5zY3JpcHRpb25FbmdpbmUodGhpcy5zZXR0aW5ncywgdGhpcy5hcHAudmF1bHQpXG5cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdvYnNpZGlhbi10cmFuc2NyaXB0aW9uLXRyYW5zY3JpYmUtYWxsLWluLXZpZXcnLFxuXHRcdFx0bmFtZTogJ1RyYW5zY3JpYmUgYWxsIGF1ZGlvIGZpbGVzIGluIHZpZXcnLFxuXHRcdFx0ZWRpdG9yQ2FsbGJhY2s6IGFzeW5jIChlZGl0b3I6IEVkaXRvciwgdmlldzogTWFya2Rvd25WaWV3KSA9PiB7XG5cdFx0XHRcdC8vIEdldCB0aGUgY3VycmVudCBmaWxlcGF0aFxuXHRcdFx0XHRjb25zdCBtYXJrZG93bkZpbGVQYXRoID0gdmlldy5maWxlLnBhdGg7XG5cdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnVHJhbnNjcmliaW5nIGFsbCBhdWRpbyBmaWxlcyBpbiAnICsgbWFya2Rvd25GaWxlUGF0aCk7XG5cdFx0XHRcdG5ldyBOb3RpY2UoJ1RyYW5zY3JpYmluZyBhbGwgYXVkaW8gZmlsZXMgaW4gJyArIHZpZXcuZmlsZS5uYW1lLCAzMDAwKTtcblxuXHRcdFx0XHQvLyBHZXQgYWxsIGxpbmtlZCBmaWxlcyBpbiB0aGUgbWFya2Rvd24gZmlsZVxuXHRcdFx0XHRjb25zdCBmaWxlc0xpbmtlZCA9IE9iamVjdC5rZXlzKHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUucmVzb2x2ZWRMaW5rc1ttYXJrZG93bkZpbGVQYXRoXSk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUpO1xuXG5cdFx0XHRcdC8vIE5vdyB0aGF0IHdlIGhhdmUgYWxsIHRoZSBmaWxlcyBsaW5rZWQgaW4gdGhlIG1hcmtkb3duIGZpbGUsIHdlIG5lZWQgdG8gZmlsdGVyIHRoZW0gYnkgdGhlIGZpbGUgZXh0ZW5zaW9ucyB3ZSB3YW50IHRvIHRyYW5zY3JpYmVcblx0XHRcdFx0Y29uc3QgZmlsZXNUb1RyYW5zY3JpYmU6IFRGaWxlW10gPSBbXTtcblx0XHRcdFx0Zm9yIChjb25zdCBsaW5rZWRGaWxlUGF0aCBvZiBmaWxlc0xpbmtlZCkge1xuXHRcdFx0XHRcdGNvbnN0IGxpbmtlZEZpbGVFeHRlbnNpb24gPSBsaW5rZWRGaWxlUGF0aC5zcGxpdCgnLicpLnBvcCgpO1xuXHRcdFx0XHRcdGlmIChsaW5rZWRGaWxlRXh0ZW5zaW9uID09PSB1bmRlZmluZWQgfHwgIXRoaXMuc2V0dGluZ3MudHJhbnNjcmliZUZpbGVFeHRlbnNpb25zLmluY2x1ZGVzKGxpbmtlZEZpbGVFeHRlbnNpb24udG9Mb3dlckNhc2UoKSkpIHtcblx0XHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnU2tpcHBpbmcgJyArIGxpbmtlZEZpbGVQYXRoICsgJyBiZWNhdXNlIHRoZSBmaWxlIGV4dGVuc2lvbiBpcyBub3QgaW4gdGhlIGxpc3Qgb2YgdHJhbnNjcmliZWFibGUgZmlsZSBleHRlbnNpb25zJyk7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBXZSBub3cga25vdyB0aGF0IHRoZSBmaWxlIGV4dGVuc2lvbiBpcyBpbiB0aGUgbGlzdCBvZiB0cmFuc2NyaWJlYWJsZSBmaWxlIGV4dGVuc2lvbnNcblx0XHRcdFx0XHRjb25zdCBsaW5rZWRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGxpbmtlZEZpbGVQYXRoKTtcblxuXHRcdFx0XHRcdC8vIFZhbGlkYXRlIHRoYXQgd2UgYXJlIGRlYWxpbmcgd2l0aCBhIGZpbGUgYW5kIGFkZCBpdCB0byB0aGUgbGlzdCBvZiB2ZXJpZmllZCBmaWxlcyB0byB0cmFuc2NyaWJlIFxuXHRcdFx0XHRcdGlmIChsaW5rZWRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIGZpbGVzVG9UcmFuc2NyaWJlLnB1c2gobGlua2VkRmlsZSk7XG5cdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ0NvdWxkIG5vdCBmaW5kIGZpbGUgJyArIGxpbmtlZEZpbGVQYXRoKTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cblx0XHRcdFx0Ly8gTm93IHRoYXQgd2UgaGF2ZSBhbGwgdGhlIGZpbGVzIHRvIHRyYW5zY3JpYmUsIHdlIGNhbiB0cmFuc2NyaWJlIHRoZW1cblx0XHRcdFx0Zm9yIChjb25zdCBmaWxlVG9UcmFuc2NyaWJlIG9mIGZpbGVzVG9UcmFuc2NyaWJlKSB7XG5cdFx0XHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdUcmFuc2NyaWJpbmcgJyArIGZpbGVUb1RyYW5zY3JpYmUucGF0aCk7XG5cblx0XHRcdFx0XHR0aGlzLnRyYW5zY3JpcHRpb25fZW5naW5lLmdldFRyYW5zY3JpcHRpb24oZmlsZVRvVHJhbnNjcmliZSkudGhlbihhc3luYyAodHJhbnNjcmlwdGlvbikgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKHRyYW5zY3JpcHRpb24pO1xuXG5cdFx0XHRcdFx0XHR2YXIgZmlsZVRleHQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKHZpZXcuZmlsZSlcblx0XHRcdFx0XHRcdGNvbnN0IGZpbGVMaW5rU3RyaW5nID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5maWxlVG9MaW5rdGV4dChmaWxlVG9UcmFuc2NyaWJlLCB2aWV3LmZpbGUucGF0aCk7IC8vIFRoaXMgaXMgdGhlIHN0cmluZyB0aGF0IGlzIHVzZWQgdG8gbGluayB0aGUgYXVkaW8gZmlsZSBpbiB0aGUgbWFya2Rvd24gZmlsZS4gSWYgZmlsZXMgYXJlIG1vdmVkIHRoaXMgcG90ZW50aWFsbHkgYnJlYWtzLCBidXQgT2JzaWRpYW4gaGFzIGJ1aWx0LWluIGhhbmRsZXJzIGZvciB0aGlzLCBhbmQgaGFuZGxpbmcgdGhhdCBpcyBvdXRzaWRlIHRoZSBzY29wZSBvZiB0aGlzIHBsdWdpblxuXHRcdFx0XHRcdFx0Y29uc3QgZmlsZUxpbmtTdHJpbmdUYWdnZWQgPSBgW1ske2ZpbGVMaW5rU3RyaW5nfV1dYDsgLy8gVGhpcyBpcyB0aGUgc3RyaW5nIHRoYXQgaXMgdXNlZCB0byBsaW5rIHRoZSBhdWRpbyBmaWxlIGluIHRoZSBtYXJrZG93biBmaWxlLlxuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coZmlsZUxpbmtTdHJpbmcpXG5cblx0XHRcdFx0XHRcdC8vIFBlcmZvcm0gYSBzdHJpbmcgcmVwbGFjZW1lbnQsIGFkZCB0aGUgdHJhbnNjcmlwdGlvbiB0byB0aGUgbmV4dCBsaW5lIGFmdGVyIHRoZSBmaWxlIGxpbmtcblx0XHRcdFx0XHRcdGNvbnN0IHN0YXJ0UmVwbGFjZW1lbnRJbmRleCA9IGZpbGVUZXh0LmluZGV4T2YoZmlsZUxpbmtTdHJpbmdUYWdnZWQpICsgZmlsZUxpbmtTdHJpbmdUYWdnZWQubGVuZ3RoO1xuXHRcdFx0XHRcdFx0Ly8gZmlsZVRleHQgPSBbZmlsZVRleHQuc2xpY2UoMCwgc3RhcnRSZXBsYWNlbWVudEluZGV4KSwgYFxcblxcYFxcYFxcYCR7dHJhbnNjcmlwdGlvbn1cXGBcXGBcXGBgLCBmaWxlVGV4dC5zbGljZShzdGFydFJlcGxhY2VtZW50SW5kZXgpXS5qb2luKCcnKTtcblx0XHRcdFx0XHRcdGZpbGVUZXh0ID0gW2ZpbGVUZXh0LnNsaWNlKDAsIHN0YXJ0UmVwbGFjZW1lbnRJbmRleCksIGBcXG4ke3RyYW5zY3JpcHRpb259YCwgZmlsZVRleHQuc2xpY2Uoc3RhcnRSZXBsYWNlbWVudEluZGV4KV0uam9pbignJyk7XG5cblx0XHRcdFx0XHRcdC8vIE5vdyB0aGF0IHdlIGhhdmUgdGhlIGZpbGUgbGluZXMgd2l0aCB0aGUgdHJhbnNjcmlwdGlvbiwgd2UgY2FuIHdyaXRlIHRoZSBmaWxlXG5cdFx0XHRcdFx0XHRhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkodmlldy5maWxlLCBmaWxlVGV4dCk7XG5cblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyb3IpID0+IHtcblx0XHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBuZXcgTm90aWNlKCdFcnJvciB0cmFuc2NyaWJpbmcgZmlsZSAnICsgZmlsZVRvVHJhbnNjcmliZS5uYW1lICsgJzogJyArIGVycm9yKTtcblx0XHRcdFx0XHRcdGVsc2UgbmV3IE5vdGljZSgnRXJyb3IgdHJhbnNjcmliaW5nIGZpbGUsIGVuYWJsZSBkZWJ1ZyBtb2RlIHRvIHNlZSBtb3JlJyk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIEtpbGwgY2hpbGQgcHJvY2Vzc2VzIHdoZW4gdGhlIHBsdWdpbiBpcyB1bmxvYWRlZFxuXHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vbihcInF1aXRcIiwgKCkgPT4ge1xuXHRcdFx0VHJhbnNjcmlwdGlvbi5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xuXHRcdFx0XHRjaGlsZC5raWxsKCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdC8vIFRoaXMgYWRkcyBhIHNldHRpbmdzIHRhYiBzbyB0aGUgdXNlciBjYW4gY29uZmlndXJlIHZhcmlvdXMgYXNwZWN0cyBvZiB0aGUgcGx1Z2luXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBUcmFuc2NyaXB0aW9uU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXHR9XG5cblx0b251bmxvYWQoKSB7XG5cdFx0aWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdVbmxvYWRpbmcgT2JzaWRpYW4gVHJhbnNjcmlwdGlvbicpO1xuXHR9XG5cblx0YXN5bmMgbG9hZFNldHRpbmdzKCkge1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuXHR9XG5cblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG5cdH1cbn1cblxuY2xhc3MgVHJhbnNjcmlwdGlvblNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcblx0cGx1Z2luOiBUcmFuc2NyaXB0aW9uO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFRyYW5zY3JpcHRpb24pIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRkaXNwbGF5KCk6IHZvaWQge1xuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xuXG5cdFx0Y29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU2V0dGluZ3MgZm9yIE9ic2lkaWFuIFRyYW5zY3JpcHRpb24nIH0pO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnR2VuZXJhbCBTZXR0aW5ncycpXG5cdFx0XHQuc2V0SGVhZGluZygpXG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdUcmFuc2NyaXB0aW9uIGVuZ2luZScpXG5cdFx0XHQuc2V0RGVzYygnVGhlIHRyYW5zY3JpcHRpb24gZW5naW5lIHRvIHVzZScpXG5cdFx0XHQuc2V0VG9vbHRpcCgnU2NyaWJlIGlzIGEgY2xvdWQgYmFzZWQgdHJhbnNjcmlwdGlvbiBlbmdpbmUgb2ZmZXJlZCBieSBHYW1iaXRFbmdpbmUgKG5vIHNldCB1cCwgbW9iaWxlIGZyaWVuZGx5KS4gV2hpc3BlciBBU1IgaXMgYSBzZWxmLWhvc3RlZCBsb2NhbCB0cmFuc2NyaXB0aW9uIGVuZ2luZSB0aGF0IHVzZXMgdGhlIFdoaXNwZXIgQVNSIHB5dGhvbiBhcHAuIChyZXF1aXJlcyBzZXBhcmF0ZSBzZXQgdXAsIG5vdCBtb2JpbGUgZnJpZW5kbHkpJylcblx0XHRcdC5zZXRDbGFzcygndHJhbnNjcmlwdGlvbi1lbmdpbmUtc2V0dGluZycpXG5cdFx0XHQuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4gZHJvcGRvd25cblx0XHRcdFx0LmFkZE9wdGlvbignc2NyaWJlJywgJ1NjcmliZScpXG5cdFx0XHRcdC5hZGRPcHRpb24oJ3doaXNwZXJfYXNyJywgJ1doaXNwZXIgQVNSJylcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zY3JpcHRpb25fZW5naW5lKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhbnNjcmlwdGlvbl9lbmdpbmUgPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0XHQvLyBIaWRlIHRoZSBzZXR0aW5ncyBmb3IgdGhlIG90aGVyIHRyYW5zY3JpcHRpb24gZW5naW5lXG5cdFx0XHRcdFx0aWYgKHZhbHVlID09ICdzY3JpYmUnKSB7XG5cdFx0XHRcdFx0XHRjb250YWluZXJFbC5maW5kQWxsKCcuc2NyaWJlLXNldHRpbmdzJykuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOyB9KTtcblx0XHRcdFx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy53aGlzcGVyLWFzci1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0ZWxzZSBpZiAodmFsdWUgPT0gJ3doaXNwZXJfYXNyJykge1xuXHRcdFx0XHRcdFx0Y29udGFpbmVyRWwuZmluZEFsbCgnLnNjcmliZS1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9KTtcblx0XHRcdFx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy53aGlzcGVyLWFzci1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdFbmFibGUgdGltZXN0YW1wcycpXG5cdFx0XHQuc2V0RGVzYygnQWRkIHRpbWVzdGFtcHMgdG8gdGhlIGJlZ2lubmluZyBvZiBlYWNoIGxpbmUnKVxuXHRcdFx0LmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50aW1lc3RhbXBzKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZXN0YW1wcyA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdTY3JpYmUgU2V0dGluZ3MnKVxuXHRcdFx0LnNldENsYXNzKCdzY3JpYmUtc2V0dGluZ3MnKVxuXHRcdFx0LnNldEhlYWRpbmcoKVxuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnRW5hYmxlIHRyYW5zbGF0aW9uJylcblx0XHRcdC5zZXREZXNjKCdUcmFuc2xhdGUgdGhlIHRyYW5zY3JpcHRpb24gZnJvbSBhbnkgbGFuZ3VhZ2UgdG8gRW5nbGlzaCcpXG5cdFx0XHQuc2V0Q2xhc3MoJ3NjcmliZS1zZXR0aW5ncycpXG5cdFx0XHQuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0ZSlcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0ZSA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdTY3JpYmUgVG9rZW4nKVxuXHRcdFx0LnNldERlc2MoJ1RoZSB0b2tlbiB1c2VkIHRvIGF1dGhlbnRpY2F0ZSB3aXRoIHRoZSBTY3JpYmUgQVBJLiBHZXQgb25lIGF0IGh0dHBzOi8vc2NyaWJlLmdhbWJpdGVuZ2luZS5jb20nKVxuXHRcdFx0LnNldENsYXNzKCdzY3JpYmUtc2V0dGluZ3MnKVxuXHRcdFx0LmFkZFRleHQodGV4dCA9PiB0ZXh0XG5cdFx0XHRcdC5zZXRQbGFjZWhvbGRlcihERUZBVUxUX1NFVFRJTkdTLnNjcmliZVRva2VuKVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2NyaWJlVG9rZW4pXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5zY3JpYmVUb2tlbiA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdXaGlzcGVyIEFTUiBTZXR0aW5ncycpXG5cdFx0XHQuc2V0Q2xhc3MoJ3doaXNwZXItYXNyLXNldHRpbmdzJylcblx0XHRcdC5zZXRIZWFkaW5nKClcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ1doaXNwZXIgQVNSIFVSTCcpXG5cdFx0XHQuc2V0RGVzYygnVGhlIFVSTCBvZiB0aGUgV2hpc3BlciBBU1Igc2VydmVyOiBodHRwczovL2dpdGh1Yi5jb20vYWhtZXRvbmVyL3doaXNwZXItYXNyLXdlYnNlcnZpY2UnKVxuXHRcdFx0LnNldENsYXNzKCd3aGlzcGVyLWFzci1zZXR0aW5ncycpXG5cdFx0XHQuYWRkVGV4dCh0ZXh0ID0+IHRleHRcblx0XHRcdFx0LnNldFBsYWNlaG9sZGVyKERFRkFVTFRfU0VUVElOR1Mud2hpc3BlckFTUlVybClcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLndoaXNwZXJBU1JVcmwpXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy53aGlzcGVyQVNSVXJsID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0FkdmFuY2VkIFNldHRpbmdzJylcblx0XHRcdC5zZXRIZWFkaW5nKClcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0RlYnVnIG1vZGUnKVxuXHRcdFx0LnNldERlc2MoJ0VuYWJsZSBkZWJ1ZyBtb2RlIHRvIHNlZSBtb3JlIGNvbnNvbGUgbG9ncycpXG5cdFx0XHQuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYnVnKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVidWcgPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXG5cdFx0Ly8gSW5pdGlhbGx5IGhpZGUgdGhlIHNldHRpbmdzIGZvciB0aGUgb3RoZXIgdHJhbnNjcmlwdGlvbiBlbmdpbmVcblx0XHRpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhbnNjcmlwdGlvbl9lbmdpbmUgPT0gJ3NjcmliZScpIHtcblx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy5zY3JpYmUtc2V0dGluZ3MnKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7IGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IH0pO1xuXHRcdFx0Y29udGFpbmVyRWwuZmluZEFsbCgnLndoaXNwZXItYXNyLXNldHRpbmdzJykuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0pO1xuXHRcdH1cblx0XHRlbHNlIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFuc2NyaXB0aW9uX2VuZ2luZSA9PSAnd2hpc3Blcl9hc3InKSB7XG5cdFx0XHRjb250YWluZXJFbC5maW5kQWxsKCcuc2NyaWJlLXNldHRpbmdzJykuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0pO1xuXHRcdFx0Y29udGFpbmVyRWwuZmluZEFsbCgnLndoaXNwZXItYXNyLXNldHRpbmdzJykuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOyB9KTtcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IHR5cGUgeyBUcmFuc2NyaXB0aW9uU2V0dGluZ3MgfTtcbiIsICJpbXBvcnQgeyBUcmFuc2NyaXB0aW9uU2V0dGluZ3MgfSBmcm9tIFwic3JjL21haW5cIjtcbmltcG9ydCB7IHJlcXVlc3RVcmwsIFJlcXVlc3RVcmxQYXJhbSwgVEZpbGUsIFZhdWx0IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBwYXRocywgY29tcG9uZW50cyB9IGZyb20gXCIuL3R5cGVzL2dhbWJpdGVuZ2luZVwiO1xuaW1wb3J0IHsgcGF5bG9hZEdlbmVyYXRvciwgUGF5bG9hZERhdGEgfSBmcm9tIFwic3JjL3V0aWxzXCI7XG5cbi8vIFRoaXMgY2xhc3MgaXMgdGhlIHBhcmVudCBmb3IgdHJhbnNjcmlwdGlvbiBlbmdpbmVzLiBJdCB0YWtlcyBzZXR0aW5ncyBhbmQgYSBmaWxlIGFzIGFuIGlucHV0IGFuZCByZXR1cm5zIGEgdHJhbnNjcmlwdGlvbiBhcyBhIHN0cmluZ1xuXG50eXBlIFRyYW5zY3JpcHRpb25CYWNrZW5kID0gKGZpbGU6IFRGaWxlKSA9PiBQcm9taXNlPHN0cmluZz47XG5cbmV4cG9ydCBjbGFzcyBUcmFuc2NyaXB0aW9uRW5naW5lIHtcbiAgICBzZXR0aW5nczogVHJhbnNjcmlwdGlvblNldHRpbmdzO1xuICAgIHZhdWx0OiBWYXVsdDtcbiAgICB0cmFuc2NyaXB0aW9uX2VuZ2luZTogVHJhbnNjcmlwdGlvbkJhY2tlbmRcblxuICAgIHRyYW5zY3JpcHRpb25fZW5naW5lczogeyBba2V5OiBzdHJpbmddOiBUcmFuc2NyaXB0aW9uQmFja2VuZCB9ID0ge1xuICAgICAgICBcInNjcmliZVwiOiB0aGlzLmdldFRyYW5zY3JpcHRpb25TY3JpYmUsXG4gICAgICAgIFwid2hpc3Blcl9hc3JcIjogdGhpcy5nZXRUcmFuc2NyaXB0aW9uV2hpc3BlckFTUlxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzOiBUcmFuc2NyaXB0aW9uU2V0dGluZ3MsIHZhdWx0OiBWYXVsdCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMudmF1bHQgPSB2YXVsdDtcbiAgICB9XG5cbiAgICBzZWdtZW50c1RvVGltZXN0YW1wZWRTdHJpbmcoc2VnbWVudHM6IGNvbXBvbmVudHNbJ3NjaGVtYXMnXVsnVHJhbnNjcmlwdGlvblJlc3VsdFNlZ21lbnQnXVtdKTogc3RyaW5nIHtcbiAgICAgICAgdmFyIHRyYW5zY3JpcHRpb246IHN0cmluZyA9IFwiXCI7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uX3NlY29uZHMgPSBNYXRoLmZsb29yKHNlZ21lbnRzW3NlZ21lbnRzLmxlbmd0aCAtIDFdLmVuZCk7XG4gICAgICAgIHZhciBzdGFydF9pc29fc2xpY2UgPSAxNDtcbiAgICAgICAgaWYgKGR1cmF0aW9uX3NlY29uZHMgPj0gMzYwMCkgc3RhcnRfaXNvX3NsaWNlID0gMTE7XG4gICAgICAgIGZvciAodmFyIHMgb2Ygc2VnbWVudHMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygcy5zdGFydCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIHMudGV4dCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBzdGFydCBhbmQgZW5kIHRpbWVzIHRvIElTTyA4NjAxIGZvcm1hdCBhbmQgdGhlbiBzdWJzdHJpbmcgdG8gZ2V0IHRoZSBISDpNTTpTUyBwb3J0aW9uXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShNYXRoLmZsb29yKHMuc3RhcnQpICogMTAwMCkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoc3RhcnRfaXNvX3NsaWNlLCAxOSlcbiAgICAgICAgICAgICAgICBjb25zdCBlbmQgPSBuZXcgRGF0ZShNYXRoLmZsb29yKHMuZW5kKSAqIDEwMDApLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKHN0YXJ0X2lzb19zbGljZSwgMTkpXG4gICAgICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gYFxcYFske3N0YXJ0fSAtICR7ZW5kfV1cXGBgXG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSB0aW1lc3RhbXAgYW5kIHRoZSB0ZXh0IHRvIHRoZSB0cmFuc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgdHJhbnNjcmlwdGlvbiArPSB0aW1lc3RhbXAgKyAnOiAnICsgcy50ZXh0ICsgXCJcXG5cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgc2VnbWVudDogJHtzfWApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRyYW5zY3JpcHRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtURmlsZX0gZmlsZSBcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYSBzdHJpbmcgY29udGFpbmluZyB0aGUgdHJhbnNjcmlwdGlvbiBcbiAgICAgKi9cbiAgICBhc3luYyBnZXRUcmFuc2NyaXB0aW9uKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKGBUcmFuc2NyaXB0aW9uIGVuZ2luZTogJHt0aGlzLnNldHRpbmdzLnRyYW5zY3JpcHRpb25fZW5naW5lfWApO1xuICAgICAgICB0aGlzLnRyYW5zY3JpcHRpb25fZW5naW5lID0gdGhpcy50cmFuc2NyaXB0aW9uX2VuZ2luZXNbdGhpcy5zZXR0aW5ncy50cmFuc2NyaXB0aW9uX2VuZ2luZV07XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zY3JpcHRpb25fZW5naW5lKGZpbGUpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFRyYW5zY3JpcHRpb25XaGlzcGVyQVNSKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgLy8gTm93IHRoYXQgd2UgaGF2ZSB0aGUgZm9ybSBkYXRhIHBheWxvYWQgYXMgYW4gYXJyYXkgYnVmZmVyLCB3ZSBjYW4gcGFzcyBpdCB0byByZXF1ZXN0VVJMXG4gICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byBzZXQgdGhlIGNvbnRlbnQgdHlwZSB0byBtdWx0aXBhcnQvZm9ybS1kYXRhIGFuZCBwYXNzIGluIHRoZSBCb3VuZGFyeSBzdHJpbmdcblxuICAgICAgICBsZXQgcGF5bG9hZF9kYXRhOiBQYXlsb2FkRGF0YSA9IHt9XG4gICAgICAgIHBheWxvYWRfZGF0YVsnYXVkaW9fZmlsZSddID0gbmV3IEJsb2IoW2F3YWl0IHRoaXMudmF1bHQucmVhZEJpbmFyeShmaWxlKV0pOztcbiAgICAgICAgY29uc3QgW3JlcXVlc3RfYm9keSwgYm91bmRhcnlfc3RyaW5nXSA9IGF3YWl0IHBheWxvYWRHZW5lcmF0b3IocGF5bG9hZF9kYXRhKTtcblxuICAgICAgICBjb25zdCBvcHRpb25zOiBSZXF1ZXN0VXJsUGFyYW0gPSB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogYCR7dGhpcy5zZXR0aW5ncy53aGlzcGVyQVNSVXJsfS9hc3I/dGFzaz10cmFuc2NyaWJlJmxhbmd1YWdlPWVuYCxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBgbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLSR7Ym91bmRhcnlfc3RyaW5nfWAsXG4gICAgICAgICAgICBib2R5OiByZXF1ZXN0X2JvZHlcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gcmVxdWVzdFVybChvcHRpb25zKS50aGVuKGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgLy8gV2hpc3BlckFTUiByZXR1cm5zIGEgSlNPTiBvYmplY3Qgd2l0aCBhIHRleHQgZmllbGQgY29udGFpbmluZyB0aGUgdHJhbnNjcmlwdGlvbiBhbmQgc2VnbWVudHMgZmllbGRcbiAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLnRpbWVzdGFtcHMpIHJldHVybiB0aGlzLnNlZ21lbnRzVG9UaW1lc3RhbXBlZFN0cmluZyhyZXNwb25zZS5qc29uLnNlZ21lbnRzKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zY3JpcHRpb246IHN0cmluZyA9IHJlc3BvbnNlLmpzb24udGV4dDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNjcmlwdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUcmFuc2NyaXB0aW9uU2NyaWJlKGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgLy8gRGVjbGFyZSBjb25zdGFudHMgZm9yIHRoZSBTY3JpYmUgQVBJXG4gICAgICAgIGxldCBhcGlfYmFzZTogc3RyaW5nXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBhcGlfYmFzZSA9ICdodHRwczovL2Rldi5hcGkuZ2FtYml0ZW5naW5lLmNvbSdcbiAgICAgICAgZWxzZSBhcGlfYmFzZSA9ICdodHRwczovL2FwaS5nYW1iaXRlbmdpbmUuY29tJ1xuXG4gICAgICAgIGNvbnN0IGNyZWF0ZV90cmFuc2NyaXB0aW9uX3JlcXVlc3Q6IFJlcXVlc3RVcmxQYXJhbSA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiBgJHthcGlfYmFzZX0vdjEvc2NyaWJlL3RyYW5zY3JpcHRpb25zYCxcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5zZXR0aW5ncy5zY3JpYmVUb2tlbn1gIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7ICd0cmFuc2xhdGUnOiB0aGlzLnNldHRpbmdzLnRyYW5zbGF0ZSB9KSxcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyhcIlRyYW5zY3JpYmluZyB3aXRoIFNjcmliZVwiKTtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSB0cmFuc2NyaXB0aW9uIHJlcXVlc3QsIHRoZW4gdXBsb2FkIHRoZSBmaWxlIHRvIFNjcmliZSBTM1xuICAgICAgICByZXR1cm4gcmVxdWVzdFVybChjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXF1ZXN0KS50aGVuKGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2U6IHBhdGhzWycvdjEvc2NyaWJlL3RyYW5zY3JpcHRpb25zJ11bJ3Bvc3QnXVsncmVzcG9uc2VzJ11bJzIwMSddWydjb250ZW50J11bJ2FwcGxpY2F0aW9uL2pzb24nXSA9IHJlc3BvbnNlLmpzb247XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyhjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZSk7XG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ1VwbG9hZGluZyBmaWxlIHRvIFNjcmliZSBTMy4uLicpO1xuXG4gICAgICAgICAgICBpZiAoY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudXBsb2FkX3JlcXVlc3QgPT09IHVuZGVmaW5lZCB8fCBjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS51cGxvYWRfcmVxdWVzdC51cmwgPT09IHVuZGVmaW5lZCB8fCBjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS51cGxvYWRfcmVxdWVzdC5maWVsZHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKCdTY3JpYmUgcmV0dXJuZWQgYW4gaW52YWxpZCB1cGxvYWQgcmVxdWVzdCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnU2NyaWJlIHJldHVybmVkIGFuIGludmFsaWQgdXBsb2FkIHJlcXVlc3QnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBmb3JtIGRhdGEgcGF5bG9hZFxuICAgICAgICAgICAgbGV0IHBheWxvYWRfZGF0YTogUGF5bG9hZERhdGEgPSB7fVxuXG4gICAgICAgICAgICAvLyBBZGQgdGhlIHVwbG9hZCByZXF1ZXN0IGRhdGEgZm9yIHRoZSBTMyBwcmVzaWduZWQgVVJMIGZyb20gU2NyaWJlXG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS51cGxvYWRfcmVxdWVzdC5maWVsZHMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHBheWxvYWRfZGF0YVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKCdTY3JpYmUgcmV0dXJuZWQgYW4gaW52YWxpZCB1cGxvYWQgcmVxdWVzdCcpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1NjcmliZSByZXR1cm5lZCBhbiBpbnZhbGlkIHVwbG9hZCByZXF1ZXN0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgdGhlIG1lZGlhIGZpbGVcbiAgICAgICAgICAgIHBheWxvYWRfZGF0YVsnZmlsZSddID0gbmV3IEJsb2IoW2F3YWl0IHRoaXMudmF1bHQucmVhZEJpbmFyeShmaWxlKV0pOztcblxuICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgcmVxdWVzdCB0byBhbiBhcnJheSBidWZmZXJcbiAgICAgICAgICAgIGNvbnN0IFtyZXF1ZXN0X2JvZHksIGJvdW5kYXJ5X3N0cmluZ10gPSBhd2FpdCBwYXlsb2FkR2VuZXJhdG9yKHBheWxvYWRfZGF0YSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHVwbG9hZF9maWxlX3JlcXVlc3Q6IFJlcXVlc3RVcmxQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IGNyZWF0ZV90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlLnVwbG9hZF9yZXF1ZXN0LnVybCxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogYG11bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0ke2JvdW5kYXJ5X3N0cmluZ31gLFxuICAgICAgICAgICAgICAgIGJvZHk6IHJlcXVlc3RfYm9keVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZWNvZGUgdXBsb2FkIGZpbGUgcmVxdWVzdCBhbmQgbG9nIGl0XG4gICAgICAgICAgICAvLyBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgLy8gICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbiAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhkZWNvZGVyLmRlY29kZShyZXF1ZXN0X2JvZHkpKTtcbiAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgLy8gVXBsb2FkIHRoZSBmaWxlIHRvIFNjcmliZSBTM1xuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmwodXBsb2FkX2ZpbGVfcmVxdWVzdCkudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ0ZpbGUgdXBsb2FkZWQgdG8gU2NyaWJlIFMzJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciBTY3JpYmUgdG8gZmluaXNoIHRyYW5zY3JpYmluZyB0aGUgZmlsZVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0X3RyYW5zY3JpcHRpb25fcmVxdWVzdDogUmVxdWVzdFVybFBhcmFtID0ge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IGAke2FwaV9iYXNlfS92MS9zY3JpYmUvdHJhbnNjcmlwdGlvbnMvJHtjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS50cmFuc2NyaXB0aW9uLnRyYW5zY3JpcHRpb25faWR9YCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLnNldHRpbmdzLnNjcmliZVRva2VufWAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnV2FpdGluZyBmb3IgU2NyaWJlIHRvIGZpbmlzaCB0cmFuc2NyaWJpbmcuLi4nKTtcblxuICAgICAgICAgICAgICAgIC8vIFBvbGwgU2NyaWJlIHVudGlsIHRoZSB0cmFuc2NyaXB0aW9uIGlzIGNvbXBsZXRlXG4gICAgICAgICAgICAgICAgbGV0IHRyaWVzID0gMDtcbiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIHRyYW5zY3JpcHRpb24gc3RhdHVzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldF90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlOiBwYXRoc1snL3YxL3NjcmliZS90cmFuc2NyaXB0aW9ucy97dHJhbnNjcmlwdGlvbl9pZH0nXVsnZ2V0J11bJ3Jlc3BvbnNlcyddWycyMDAnXVsnY29udGVudCddWydhcHBsaWNhdGlvbi9qc29uJ10gPSBhd2FpdCByZXF1ZXN0VXJsKGdldF90cmFuc2NyaXB0aW9uX3JlcXVlc3QpLmpzb247XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyhnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRyYW5zY3JpcHRpb24gaXMgY29tcGxldGUsIHJldHVybiB0aGUgdHJhbnNjcmlwdGlvbiB0ZXh0XG4gICAgICAgICAgICAgICAgICAgIGlmIChnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS5zdGF0dXMgPT0gJ2NvbXBsZXRlJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudHJhbnNjcmlwdGlvbl90ZXh0ICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldF90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlLnRyYW5zY3JpcHRpb25fcmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElkayBob3cgYXNzZXJ0cyB3b3JrIGluIEpTLCBidXQgdGhpcyBzaG91bGQgYmUgYW4gYXNzZXJ0XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ1NjcmliZSBmaW5pc2hlZCB0cmFuc2NyaWJpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLnRpbWVzdGFtcHMpIHJldHVybiB0aGlzLnNlZ21lbnRzVG9UaW1lc3RhbXBlZFN0cmluZyhnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS50cmFuc2NyaXB0aW9uX3Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS50cmFuc2NyaXB0aW9uX3RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHJpZXMgPiA2MCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoJ1NjcmliZSB0b29rIHRvbyBsb25nIHRvIHRyYW5zY3JpYmUgdGhlIGZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnU2NyaWJlIHRvb2sgdG9vIGxvbmcgdG8gdHJhbnNjcmliZSB0aGUgZmlsZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdldF90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlLnN0YXR1cyA9PSAnZmFpbGVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoJ1NjcmliZSBmYWlsZWQgdG8gdHJhbnNjcmliZSB0aGUgZmlsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdTY3JpYmUgZmFpbGVkIHRvIHRyYW5zY3JpYmUgdGhlIGZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS5zdGF0dXMgPT0gJ3ZhbGlkYXRpb25fZmFpbGVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoJ1NjcmliZSBoYXMgZGV0ZWN0ZWQgYW4gaW52YWxpZCBmaWxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1NjcmliZSBoYXMgZGV0ZWN0ZWQgYW4gaW52YWxpZCBmaWxlJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRyYW5zY3JpcHRpb24gaXMgc3RpbGwgaW4gcHJvZ3Jlc3MsIHdhaXQgMyBzZWNvbmRzIGFuZCB0cnkgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmllcyArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2xlZXAoMzAwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiLyogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIE9ic2lkaWFuIFRyYW5zY3JpcHQgKi9cbmltcG9ydCB7IEFwcCwgRmlsZVN5c3RlbUFkYXB0ZXIsIFRGaWxlLCBWYXVsdCwgZ2V0QmxvYkFycmF5QnVmZmVyIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjb25zdCByYW5kb21TdHJpbmcgPSAobGVuZ3RoOiBudW1iZXIpID0+IEFycmF5KGxlbmd0aCArIDEpLmpvaW4oKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpICsgJzAwMDAwMDAwMDAwMDAwMDAwJykuc2xpY2UoMiwgMTgpKS5zbGljZSgwLCBsZW5ndGgpXG5leHBvcnQgY29uc3QgZ2V0QWxsTGluZXNGcm9tRmlsZSA9IChjYWNoZTogc3RyaW5nKSA9PiBjYWNoZS5zcGxpdCgvXFxyP1xcbi8pXG5leHBvcnQgY29uc3QgY29tYmluZUZpbGVMaW5lcyA9IChsaW5lczogc3RyaW5nW10pID0+IGxpbmVzLmpvaW4oXCJcXG5cIilcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhdWx0QWJzb2x1dGVQYXRoKGFwcDogQXBwKSB7XG4gICAgLy8gT3JpZ2luYWwgY29kZSB3YXMgY29waWVkIDIwMjEtMDgtMjIgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcGhpYnIwL29ic2lkaWFuLW9wZW4td2l0aC9ibG9iLzg0ZjBlMjViYThlODM1NWZmODNiMjJmNDA1MGFkZGU0Y2M2NzYzZWEvbWFpbi50cyNMNjYtTDY3XG4gICAgLy8gQnV0IHRoZSBjb2RlIGhhcyBiZWVuIHJld3JpdHRlbiAyMDIxLTA4LTI3IGFzIHBlciBodHRwczovL2dpdGh1Yi5jb20vb2JzaWRpYW5tZC9vYnNpZGlhbi1yZWxlYXNlcy9wdWxsLzQzMyNpc3N1ZWNvbW1lbnQtOTA2MDg3MDk1XG4gICAgY29uc3QgYWRhcHRlciA9IGFwcC52YXVsdC5hZGFwdGVyO1xuICAgIGlmIChhZGFwdGVyIGluc3RhbmNlb2YgRmlsZVN5c3RlbUFkYXB0ZXIpIHtcbiAgICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2V0QmFzZVBhdGgoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbnR5cGUgUGF5bG9hZEFuZEJvdW5kYXJ5ID0gW0FycmF5QnVmZmVyLCBzdHJpbmddO1xuXG5cbmV4cG9ydCB0eXBlIFBheWxvYWREYXRhID0geyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBCbG9iIHwgQXJyYXlCdWZmZXIgfVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcGF5bG9hZEdlbmVyYXRvcihwYXlsb2FkX2RhdGE6IFBheWxvYWREYXRhKTogUHJvbWlzZTxQYXlsb2FkQW5kQm91bmRhcnk+IHtcbiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGEgd29ya2Fyb3VuZCB0byBjdXJyZW50IE9ic2lkaWFuIEFQSSBsaW1pdGF0aW9uczogcmVxdWVzdFVSTCBvbmx5IHN1cHBvcnRzIHN0cmluZyBkYXRhIG9yIGFuIHVubmFtZWQgYmxvYiwgbm90IGtleS12YWx1ZSBmb3JtZGF0YVxuICAgIC8vIEVzc2VudGlhbGx5IHdoYXQgd2UncmUgZG9pbmcgaGVyZSBpcyBjb25zdHJ1Y3RpbmcgYSBtdWx0aXBhcnQvZm9ybS1kYXRhIHBheWxvYWQgbWFudWFsbHkgYXMgYSBzdHJpbmcgYW5kIHRoZW4gcGFzc2luZyBpdCB0byByZXF1ZXN0VVJMXG5cbiAgICBjb25zdCBib3VuZGFyeV9zdHJpbmcgPSBgQm91bmRhcnkke3JhbmRvbVN0cmluZygxNil9YDtcbiAgICBjb25zdCBib3VuZGFyeSA9IGAtLS0tLS0ke2JvdW5kYXJ5X3N0cmluZ31gO1xuICAgIC8vIGNvbnN0IGNodW5rczogVWludDhBcnJheSB8IEFycmF5QnVmZmVyW10gPSBbXTtcbiAgICBjb25zdCBjaHVua3M6IGFueVtdID0gW107XG4gICAgLy8gYXdhaXQgcGF5bG9hZF9kYXRhLmZvckVhY2goYXN5bmMgKHZhbHVlLCBrZXkpID0+IHtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwYXlsb2FkX2RhdGEpKSB7XG4gICAgICAgIC8vIFN0YXJ0IG9mIGEgbmV3IHBhcnRcbiAgICAgICAgY2h1bmtzLnB1c2gobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGAke2JvdW5kYXJ5fVxcclxcbmApKTtcblxuICAgICAgICAvLyBJZiB0aGUgdmFsdWUgaXMgYSBzdHJpbmcsIHRoZW4gaXQncyBhIGtleS12YWx1ZSBwYWlyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjaHVua3MucHVzaChuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYENvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT1cIiR7a2V5fVwiXFxyXFxuXFxyXFxuYCkpO1xuICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGAke3ZhbHVlfVxcclxcbmApKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPVwiJHtrZXl9XCI7IGZpbGVuYW1lPVwiYmxvYlwiXFxyXFxuQ29udGVudC1UeXBlOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiXFxyXFxuXFxyXFxuYCkpO1xuICAgICAgICAgICAgY2h1bmtzLnB1c2goYXdhaXQgZ2V0QmxvYkFycmF5QnVmZmVyKHZhbHVlKSk7XG4gICAgICAgICAgICBjaHVua3MucHVzaChuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoJ1xcclxcbicpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBVaW50OEFycmF5KGF3YWl0IG5ldyBSZXNwb25zZSh2YWx1ZSkuYXJyYXlCdWZmZXIoKSkpO1xuICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCdcXHJcXG4nKSk7XG4gICAgICAgIH1cblxuICAgIH1cbiAgICBhd2FpdCBQcm9taXNlLmFsbChjaHVua3MpO1xuICAgIGNodW5rcy5wdXNoKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHtib3VuZGFyeX0tLVxcclxcbmApKTtcbiAgICByZXR1cm4gW2F3YWl0IG5ldyBCbG9iKGNodW5rcykuYXJyYXlCdWZmZXIoKSwgYm91bmRhcnlfc3RyaW5nXTtcbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQSx1QkFBNEY7OztBQ0E1Rix1QkFBMEQ7OztBQ0ExRCxzQkFBeUU7QUFFbEUsSUFBTSxlQUFlLENBQUMsV0FBbUIsTUFBTSxTQUFTLENBQUMsRUFBRSxLQUFNLE1BQUssT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLHFCQUFxQixNQUFNLEdBQUcsRUFBRSxDQUFDLEVBQUUsTUFBTSxHQUFHLE1BQU07QUFtQnZKLGdDQUF1QyxjQUF3RDtBQUkzRixRQUFNLGtCQUFrQixXQUFXLGFBQWEsRUFBRTtBQUNsRCxRQUFNLFdBQVcsU0FBUztBQUUxQixRQUFNLFNBQWdCLENBQUM7QUFFdkIsYUFBVyxDQUFDLEtBQUssVUFBVSxPQUFPLFFBQVEsWUFBWSxHQUFHO0FBRXJELFdBQU8sS0FBSyxJQUFJLFlBQVksRUFBRSxPQUFPLEdBQUc7QUFBQSxDQUFjLENBQUM7QUFHdkQsUUFBSSxPQUFPLFVBQVUsVUFBVTtBQUMzQixhQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyx5Q0FBeUM7QUFBQTtBQUFBLENBQWMsQ0FBQztBQUM3RixhQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyxHQUFHO0FBQUEsQ0FBVyxDQUFDO0FBQUEsSUFDeEQsV0FDUyxpQkFBaUIsTUFBTTtBQUM1QixhQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyx5Q0FBeUM7QUFBQTtBQUFBO0FBQUEsQ0FBMkUsQ0FBQztBQUMxSixhQUFPLEtBQUssTUFBTSx3Q0FBbUIsS0FBSyxDQUFDO0FBQzNDLGFBQU8sS0FBSyxJQUFJLFlBQVksRUFBRSxPQUFPLE1BQU0sQ0FBQztBQUFBLElBQ2hELE9BQ0s7QUFDRCxhQUFPLEtBQUssSUFBSSxXQUFXLE1BQU0sSUFBSSxTQUFTLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztBQUNuRSxhQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyxNQUFNLENBQUM7QUFBQSxJQUNoRDtBQUFBLEVBRUo7QUFDQSxRQUFNLFFBQVEsSUFBSSxNQUFNO0FBQ3hCLFNBQU8sS0FBSyxJQUFJLFlBQVksRUFBRSxPQUFPLEdBQUc7QUFBQSxDQUFnQixDQUFDO0FBQ3pELFNBQU8sQ0FBQyxNQUFNLElBQUksS0FBSyxNQUFNLEVBQUUsWUFBWSxHQUFHLGVBQWU7QUFDakU7OztBRDdDTyxJQUFNLHNCQUFOLE1BQTBCO0FBQUEsRUFVN0IsWUFBWSxVQUFpQyxPQUFjO0FBTDNELGlDQUFpRTtBQUFBLE1BQzdELFVBQVUsS0FBSztBQUFBLE1BQ2YsZUFBZSxLQUFLO0FBQUEsSUFDeEI7QUFHSSxTQUFLLFdBQVc7QUFDaEIsU0FBSyxRQUFRO0FBQUEsRUFDakI7QUFBQSxFQUVBLDRCQUE0QixVQUF5RTtBQUNqRyxRQUFJLGdCQUF3QjtBQUM1QixVQUFNLG1CQUFtQixLQUFLLE1BQU0sU0FBUyxTQUFTLFNBQVMsR0FBRyxHQUFHO0FBQ3JFLFFBQUksa0JBQWtCO0FBQ3RCLFFBQUksb0JBQW9CO0FBQU0sd0JBQWtCO0FBQ2hELGFBQVMsS0FBSyxVQUFVO0FBQ3BCLFVBQUksT0FBTyxFQUFFLFVBQVUsWUFBWSxPQUFPLEVBQUUsU0FBUyxVQUFVO0FBRTNELGNBQU0sUUFBUSxJQUFJLEtBQUssS0FBSyxNQUFNLEVBQUUsS0FBSyxJQUFJLEdBQUksRUFBRSxZQUFZLEVBQUUsVUFBVSxpQkFBaUIsRUFBRTtBQUM5RixjQUFNLE1BQU0sSUFBSSxLQUFLLEtBQUssTUFBTSxFQUFFLEdBQUcsSUFBSSxHQUFJLEVBQUUsWUFBWSxFQUFFLFVBQVUsaUJBQWlCLEVBQUU7QUFDMUYsY0FBTSxZQUFZLE1BQU0sV0FBVztBQUVuQyx5QkFBaUIsWUFBWSxPQUFPLEVBQUUsT0FBTztBQUFBLE1BQ2pELE9BQ0s7QUFDRCxZQUFJLEtBQUssU0FBUztBQUFPLGtCQUFRLE1BQU0sb0JBQW9CLEdBQUc7QUFBQSxNQUNsRTtBQUFBLElBQ0o7QUFDQSxXQUFPO0FBQUEsRUFDWDtBQUFBLEVBT0EsTUFBTSxpQkFBaUIsTUFBOEI7QUFDakQsUUFBSSxLQUFLLFNBQVM7QUFBTyxjQUFRLElBQUkseUJBQXlCLEtBQUssU0FBUyxzQkFBc0I7QUFDbEcsU0FBSyx1QkFBdUIsS0FBSyxzQkFBc0IsS0FBSyxTQUFTO0FBQ3JFLFdBQU8sS0FBSyxxQkFBcUIsSUFBSTtBQUFBLEVBQ3pDO0FBQUEsRUFFQSxNQUFNLDJCQUEyQixNQUE4QjtBQUkzRCxRQUFJLGVBQTRCLENBQUM7QUFDakMsaUJBQWEsZ0JBQWdCLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxNQUFNLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFBRTtBQUMzRSxVQUFNLENBQUMsY0FBYyxtQkFBbUIsTUFBTSxpQkFBaUIsWUFBWTtBQUUzRSxVQUFNLFVBQTJCO0FBQUEsTUFDN0IsUUFBUTtBQUFBLE1BQ1IsS0FBSyxHQUFHLEtBQUssU0FBUztBQUFBLE1BQ3RCLGFBQWEscUNBQXFDO0FBQUEsTUFDbEQsTUFBTTtBQUFBLElBQ1Y7QUFFQSxXQUFPLGlDQUFXLE9BQU8sRUFBRSxLQUFLLE9BQU8sYUFBYTtBQUNoRCxVQUFJLEtBQUssU0FBUztBQUFPLGdCQUFRLElBQUksUUFBUTtBQUc3QyxVQUFJLEtBQUssU0FBUztBQUFZLGVBQU8sS0FBSyw0QkFBNEIsU0FBUyxLQUFLLFFBQVE7QUFBQSxXQUN2RjtBQUNELGNBQU0sZ0JBQXdCLFNBQVMsS0FBSztBQUM1QyxlQUFPO0FBQUEsTUFDWDtBQUFBLElBQ0osQ0FBQyxFQUFFLE1BQU0sQ0FBQyxVQUFVO0FBQ2hCLFVBQUksS0FBSyxTQUFTO0FBQU8sZ0JBQVEsTUFBTSxLQUFLO0FBQzVDLGFBQU8sUUFBUSxPQUFPLEtBQUs7QUFBQSxJQUMvQixDQUFDO0FBQUEsRUFDTDtBQUFBLEVBRUEsTUFBTSx1QkFBdUIsTUFBOEI7QUFFdkQsUUFBSTtBQUNKLFFBQUksS0FBSyxTQUFTO0FBQU8saUJBQVc7QUFBQTtBQUMvQixpQkFBVztBQUVoQixVQUFNLCtCQUFnRDtBQUFBLE1BQ2xELFFBQVE7QUFBQSxNQUNSLEtBQUssR0FBRztBQUFBLE1BQ1IsU0FBUyxFQUFFLGlCQUFpQixVQUFVLEtBQUssU0FBUyxjQUFjO0FBQUEsTUFDbEUsTUFBTSxLQUFLLFVBQVUsRUFBRSxhQUFhLEtBQUssU0FBUyxVQUFVLENBQUM7QUFBQSxJQUNqRTtBQUVBLFFBQUksS0FBSyxTQUFTO0FBQU8sY0FBUSxJQUFJLDBCQUEwQjtBQUUvRCxXQUFPLGlDQUFXLDRCQUE0QixFQUFFLEtBQUssT0FBTyxhQUFhO0FBQ3JFLFlBQU0sZ0NBQStILFNBQVM7QUFFOUksVUFBSSxLQUFLLFNBQVM7QUFBTyxnQkFBUSxJQUFJLDZCQUE2QjtBQUNsRSxVQUFJLEtBQUssU0FBUztBQUFPLGdCQUFRLElBQUksZ0NBQWdDO0FBRXJFLFVBQUksOEJBQThCLG1CQUFtQixVQUFhLDhCQUE4QixlQUFlLFFBQVEsVUFBYSw4QkFBOEIsZUFBZSxXQUFXLFFBQVc7QUFDbk0sWUFBSSxLQUFLLFNBQVM7QUFBTyxrQkFBUSxNQUFNLDJDQUEyQztBQUNsRixlQUFPLFFBQVEsT0FBTywyQ0FBMkM7QUFBQSxNQUNyRTtBQUdBLFVBQUksZUFBNEIsQ0FBQztBQUdqQyxpQkFBVyxDQUFDLEtBQUssVUFBVSxPQUFPLFFBQVEsOEJBQThCLGVBQWUsTUFBTSxHQUFHO0FBQzVGLFlBQUksT0FBTyxRQUFRLFlBQVksT0FBTyxVQUFVO0FBQVUsdUJBQWEsT0FBTztBQUFBLGFBQ3pFO0FBQ0QsY0FBSSxLQUFLLFNBQVM7QUFBTyxvQkFBUSxNQUFNLDJDQUEyQztBQUNsRixpQkFBTyxRQUFRLE9BQU8sMkNBQTJDO0FBQUEsUUFDckU7QUFBQSxNQUNKO0FBR0EsbUJBQWEsVUFBVSxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssTUFBTSxXQUFXLElBQUksQ0FBQyxDQUFDO0FBQUU7QUFHckUsWUFBTSxDQUFDLGNBQWMsbUJBQW1CLE1BQU0saUJBQWlCLFlBQVk7QUFFM0UsWUFBTSxzQkFBdUM7QUFBQSxRQUN6QyxRQUFRO0FBQUEsUUFDUixLQUFLLDhCQUE4QixlQUFlO0FBQUEsUUFDbEQsYUFBYSxxQ0FBcUM7QUFBQSxRQUNsRCxNQUFNO0FBQUEsTUFDVjtBQVNBLGFBQU8saUNBQVcsbUJBQW1CLEVBQUUsS0FBSyxPQUFPLGNBQWE7QUFDNUQsWUFBSSxLQUFLLFNBQVM7QUFBTyxrQkFBUSxJQUFJLDRCQUE0QjtBQUlqRSxjQUFNLDRCQUE2QztBQUFBLFVBQy9DLFFBQVE7QUFBQSxVQUNSLEtBQUssR0FBRyxxQ0FBcUMsOEJBQThCLGNBQWM7QUFBQSxVQUN6RixTQUFTLEVBQUUsaUJBQWlCLFVBQVUsS0FBSyxTQUFTLGNBQWM7QUFBQSxRQUN0RTtBQUVBLFlBQUksS0FBSyxTQUFTO0FBQU8sa0JBQVEsSUFBSSw4Q0FBOEM7QUFHbkYsWUFBSSxRQUFRO0FBQ1osZUFBTyxNQUFNO0FBRVQsZ0JBQU0sNkJBQThJLE1BQU0saUNBQVcseUJBQXlCLEVBQUU7QUFDaE0sY0FBSSxLQUFLLFNBQVM7QUFBTyxvQkFBUSxJQUFJLDBCQUEwQjtBQUcvRCxjQUFJLDJCQUEyQixVQUFVLGNBQ3JDLDJCQUEyQix1QkFBdUIsVUFDbEQsMkJBQTJCLHlCQUF5QixRQUFXO0FBRS9ELGdCQUFJLEtBQUssU0FBUztBQUFPLHNCQUFRLElBQUksOEJBQThCO0FBQ25FLGdCQUFJLEtBQUssU0FBUztBQUFZLHFCQUFPLEtBQUssNEJBQTRCLDJCQUEyQixvQkFBb0I7QUFBQTtBQUNoSCxxQkFBTywyQkFBMkI7QUFBQSxVQUMzQyxXQUNTLFFBQVEsSUFBSTtBQUNqQixnQkFBSSxLQUFLLFNBQVM7QUFBTyxzQkFBUSxNQUFNLDZDQUE2QztBQUNwRixtQkFBTyxRQUFRLE9BQU8sNkNBQTZDO0FBQUEsVUFDdkUsV0FDUywyQkFBMkIsVUFBVSxVQUFVO0FBQ3BELGdCQUFJLEtBQUssU0FBUztBQUFPLHNCQUFRLE1BQU0sc0NBQXNDO0FBQzdFLG1CQUFPLFFBQVEsT0FBTyxzQ0FBc0M7QUFBQSxVQUNoRSxXQUNTLDJCQUEyQixVQUFVLHFCQUFxQjtBQUMvRCxnQkFBSSxLQUFLLFNBQVM7QUFBTyxzQkFBUSxNQUFNLHFDQUFxQztBQUM1RSxtQkFBTyxRQUFRLE9BQU8scUNBQXFDO0FBQUEsVUFDL0QsT0FFSztBQUNELHFCQUFTO0FBQ1Qsa0JBQU0sTUFBTSxHQUFJO0FBQUEsVUFDcEI7QUFBQSxRQUNKO0FBQUEsTUFDSixDQUFDLEVBQUUsTUFBTSxDQUFDLFVBQVU7QUFDaEIsWUFBSSxLQUFLLFNBQVM7QUFBTyxrQkFBUSxNQUFNLEtBQUs7QUFDNUMsZUFBTyxRQUFRLE9BQU8sS0FBSztBQUFBLE1BQy9CLENBQUM7QUFBQSxJQUdMLENBQUMsRUFBRSxNQUFNLENBQUMsVUFBVTtBQUNoQixVQUFJLEtBQUssU0FBUztBQUFPLGdCQUFRLE1BQU0sS0FBSztBQUM1QyxhQUFPLFFBQVEsT0FBTyxLQUFLO0FBQUEsSUFDL0IsQ0FBQztBQUFBLEVBQ0w7QUFDSjs7O0FENUxBLElBQU0sbUJBQTBDO0FBQUEsRUFDL0MsWUFBWTtBQUFBLEVBQ1osV0FBVztBQUFBLEVBQ1gsMEJBQTBCLENBQUMsT0FBTyxPQUFPLFFBQVEsT0FBTyxRQUFRLE9BQU8sT0FBTyxPQUFPLFFBQVEsUUFBUSxRQUFRLE9BQU8sT0FBTyxPQUFPLE9BQU8sT0FBTyxPQUFPLFFBQVEsT0FBTyxLQUFLO0FBQUEsRUFDM0ssZUFBZTtBQUFBLEVBQ2YsT0FBTztBQUFBLEVBQ1AsYUFBYTtBQUFBLEVBQ2Isc0JBQXNCO0FBQ3ZCO0FBRUEsSUFBcUIsaUJBQXJCLGNBQTJDLHdCQUFPO0FBQUEsRUFPakQsTUFBTSxTQUFTO0FBQ2QsVUFBTSxLQUFLLGFBQWE7QUFDeEIsbUJBQWMsU0FBUztBQUN2QixZQUFRLElBQUksZ0NBQWdDO0FBQzVDLFNBQUssdUJBQXVCLElBQUksb0JBQW9CLEtBQUssVUFBVSxLQUFLLElBQUksS0FBSztBQUVqRixTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLGdCQUFnQixPQUFPLFFBQWdCLFNBQXVCO0FBRTdELGNBQU0sbUJBQW1CLEtBQUssS0FBSztBQUNuQyxZQUFJLEtBQUssU0FBUztBQUFPLGtCQUFRLElBQUkscUNBQXFDLGdCQUFnQjtBQUMxRixZQUFJLHdCQUFPLHFDQUFxQyxLQUFLLEtBQUssTUFBTSxHQUFJO0FBR3BFLGNBQU0sY0FBYyxPQUFPLEtBQUssS0FBSyxJQUFJLGNBQWMsY0FBYyxpQkFBaUI7QUFDdEYsZ0JBQVEsSUFBSSxLQUFLLElBQUksYUFBYTtBQUdsQyxjQUFNLG9CQUE2QixDQUFDO0FBQ3BDLG1CQUFXLGtCQUFrQixhQUFhO0FBQ3pDLGdCQUFNLHNCQUFzQixlQUFlLE1BQU0sR0FBRyxFQUFFLElBQUk7QUFDMUQsY0FBSSx3QkFBd0IsVUFBYSxDQUFDLEtBQUssU0FBUyx5QkFBeUIsU0FBUyxvQkFBb0IsWUFBWSxDQUFDLEdBQUc7QUFDN0gsZ0JBQUksS0FBSyxTQUFTO0FBQU8sc0JBQVEsSUFBSSxjQUFjLGlCQUFpQixrRkFBa0Y7QUFDdEo7QUFBQSxVQUNEO0FBR0EsZ0JBQU0sYUFBYSxLQUFLLElBQUksTUFBTSxzQkFBc0IsY0FBYztBQUd0RSxjQUFJLHNCQUFzQjtBQUFPLDhCQUFrQixLQUFLLFVBQVU7QUFBQSxlQUM3RDtBQUNKLGdCQUFJLEtBQUssU0FBUztBQUFPLHNCQUFRLElBQUkseUJBQXlCLGNBQWM7QUFDNUU7QUFBQSxVQUNEO0FBQUEsUUFDRDtBQUlBLG1CQUFXLG9CQUFvQixtQkFBbUI7QUFDakQsY0FBSSxLQUFLLFNBQVM7QUFBTyxvQkFBUSxJQUFJLGtCQUFrQixpQkFBaUIsSUFBSTtBQUU1RSxlQUFLLHFCQUFxQixpQkFBaUIsZ0JBQWdCLEVBQUUsS0FBSyxPQUFPLGtCQUFrQjtBQUMxRixnQkFBSSxLQUFLLFNBQVM7QUFBTyxzQkFBUSxJQUFJLGFBQWE7QUFFbEQsZ0JBQUksV0FBVyxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUssS0FBSyxJQUFJO0FBQ2xELGtCQUFNLGlCQUFpQixLQUFLLElBQUksY0FBYyxlQUFlLGtCQUFrQixLQUFLLEtBQUssSUFBSTtBQUM3RixrQkFBTSx1QkFBdUIsS0FBSztBQUNsQyxvQkFBUSxJQUFJLGNBQWM7QUFHMUIsa0JBQU0sd0JBQXdCLFNBQVMsUUFBUSxvQkFBb0IsSUFBSSxxQkFBcUI7QUFFNUYsdUJBQVcsQ0FBQyxTQUFTLE1BQU0sR0FBRyxxQkFBcUIsR0FBRztBQUFBLEVBQUssaUJBQWlCLFNBQVMsTUFBTSxxQkFBcUIsQ0FBQyxFQUFFLEtBQUssRUFBRTtBQUcxSCxrQkFBTSxLQUFLLElBQUksTUFBTSxPQUFPLEtBQUssTUFBTSxRQUFRO0FBQUEsVUFFaEQsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxVQUFVO0FBQ25CLGdCQUFJLEtBQUssU0FBUztBQUFPLGtCQUFJLHdCQUFPLDZCQUE2QixpQkFBaUIsT0FBTyxPQUFPLEtBQUs7QUFBQTtBQUNoRyxrQkFBSSx3QkFBTyx3REFBd0Q7QUFBQSxVQUN6RSxDQUFDO0FBQUEsUUFDRjtBQUFBLE1BQ0Q7QUFBQSxJQUNELENBQUM7QUFHRCxTQUFLLElBQUksVUFBVSxHQUFHLFFBQVEsTUFBTTtBQUNuQyxxQkFBYyxTQUFTLFFBQVEsQ0FBQyxVQUFVO0FBQ3pDLGNBQU0sS0FBSztBQUFBLE1BQ1osQ0FBQztBQUFBLElBQ0YsQ0FBQztBQUdELFNBQUssY0FBYyxJQUFJLHdCQUF3QixLQUFLLEtBQUssSUFBSSxDQUFDO0FBQUEsRUFDL0Q7QUFBQSxFQUVBLFdBQVc7QUFDVixRQUFJLEtBQUssU0FBUztBQUFPLGNBQVEsSUFBSSxrQ0FBa0M7QUFBQSxFQUN4RTtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ3BCLFNBQUssV0FBVyxPQUFPLE9BQU8sQ0FBQyxHQUFHLGtCQUFrQixNQUFNLEtBQUssU0FBUyxDQUFDO0FBQUEsRUFDMUU7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNwQixVQUFNLEtBQUssU0FBUyxLQUFLLFFBQVE7QUFBQSxFQUNsQztBQUNEO0FBakdBLElBQXFCLGdCQUFyQjtBQUlDLEFBSm9CLGNBSU4sV0FBZ0MsQ0FBQztBQStGaEQsSUFBTSwwQkFBTixjQUFzQyxrQ0FBaUI7QUFBQSxFQUd0RCxZQUFZLEtBQVUsUUFBdUI7QUFDNUMsVUFBTSxLQUFLLE1BQU07QUFDakIsU0FBSyxTQUFTO0FBQUEsRUFDZjtBQUFBLEVBRUEsVUFBZ0I7QUFDZixVQUFNLEVBQUUsZ0JBQWdCO0FBRXhCLGdCQUFZLE1BQU07QUFFbEIsZ0JBQVksU0FBUyxNQUFNLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUUxRSxRQUFJLHlCQUFRLFdBQVcsRUFDckIsUUFBUSxrQkFBa0IsRUFDMUIsV0FBVztBQUViLFFBQUkseUJBQVEsV0FBVyxFQUNyQixRQUFRLHNCQUFzQixFQUM5QixRQUFRLGlDQUFpQyxFQUN6QyxXQUFXLGtQQUFrUCxFQUM3UCxTQUFTLDhCQUE4QixFQUN2QyxZQUFZLGNBQVksU0FDdkIsVUFBVSxVQUFVLFFBQVEsRUFDNUIsVUFBVSxlQUFlLGFBQWEsRUFDdEMsU0FBUyxLQUFLLE9BQU8sU0FBUyxvQkFBb0IsRUFDbEQsU0FBUyxPQUFPLFVBQVU7QUFDMUIsV0FBSyxPQUFPLFNBQVMsdUJBQXVCO0FBQzVDLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFFL0IsVUFBSSxTQUFTLFVBQVU7QUFDdEIsb0JBQVksUUFBUSxrQkFBa0IsRUFBRSxRQUFRLENBQUMsWUFBWTtBQUFFLGtCQUFRLE1BQU0sVUFBVTtBQUFBLFFBQVMsQ0FBQztBQUNqRyxvQkFBWSxRQUFRLHVCQUF1QixFQUFFLFFBQVEsQ0FBQyxZQUFZO0FBQUUsa0JBQVEsTUFBTSxVQUFVO0FBQUEsUUFBUSxDQUFDO0FBQUEsTUFDdEcsV0FDUyxTQUFTLGVBQWU7QUFDaEMsb0JBQVksUUFBUSxrQkFBa0IsRUFBRSxRQUFRLENBQUMsWUFBWTtBQUFFLGtCQUFRLE1BQU0sVUFBVTtBQUFBLFFBQVEsQ0FBQztBQUNoRyxvQkFBWSxRQUFRLHVCQUF1QixFQUFFLFFBQVEsQ0FBQyxZQUFZO0FBQUUsa0JBQVEsTUFBTSxVQUFVO0FBQUEsUUFBUyxDQUFDO0FBQUEsTUFDdkc7QUFBQSxJQUNELENBQUMsQ0FBQztBQUVKLFFBQUkseUJBQVEsV0FBVyxFQUNyQixRQUFRLG1CQUFtQixFQUMzQixRQUFRLDhDQUE4QyxFQUN0RCxVQUFVLFlBQVUsT0FDbkIsU0FBUyxLQUFLLE9BQU8sU0FBUyxVQUFVLEVBQ3hDLFNBQVMsT0FBTyxVQUFVO0FBQzFCLFdBQUssT0FBTyxTQUFTLGFBQWE7QUFDbEMsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2hDLENBQUMsQ0FBQztBQUVKLFFBQUkseUJBQVEsV0FBVyxFQUNyQixRQUFRLGlCQUFpQixFQUN6QixTQUFTLGlCQUFpQixFQUMxQixXQUFXO0FBRWIsUUFBSSx5QkFBUSxXQUFXLEVBQ3JCLFFBQVEsb0JBQW9CLEVBQzVCLFFBQVEsMERBQTBELEVBQ2xFLFNBQVMsaUJBQWlCLEVBQzFCLFVBQVUsWUFBVSxPQUNuQixTQUFTLEtBQUssT0FBTyxTQUFTLFNBQVMsRUFDdkMsU0FBUyxPQUFPLFVBQVU7QUFDMUIsV0FBSyxPQUFPLFNBQVMsWUFBWTtBQUNqQyxZQUFNLEtBQUssT0FBTyxhQUFhO0FBQUEsSUFDaEMsQ0FBQyxDQUFDO0FBRUosUUFBSSx5QkFBUSxXQUFXLEVBQ3JCLFFBQVEsY0FBYyxFQUN0QixRQUFRLGdHQUFnRyxFQUN4RyxTQUFTLGlCQUFpQixFQUMxQixRQUFRLFVBQVEsS0FDZixlQUFlLGlCQUFpQixXQUFXLEVBQzNDLFNBQVMsS0FBSyxPQUFPLFNBQVMsV0FBVyxFQUN6QyxTQUFTLE9BQU8sVUFBVTtBQUMxQixXQUFLLE9BQU8sU0FBUyxjQUFjO0FBQ25DLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNoQyxDQUFDLENBQUM7QUFFSixRQUFJLHlCQUFRLFdBQVcsRUFDckIsUUFBUSxzQkFBc0IsRUFDOUIsU0FBUyxzQkFBc0IsRUFDL0IsV0FBVztBQUViLFFBQUkseUJBQVEsV0FBVyxFQUNyQixRQUFRLGlCQUFpQixFQUN6QixRQUFRLHdGQUF3RixFQUNoRyxTQUFTLHNCQUFzQixFQUMvQixRQUFRLFVBQVEsS0FDZixlQUFlLGlCQUFpQixhQUFhLEVBQzdDLFNBQVMsS0FBSyxPQUFPLFNBQVMsYUFBYSxFQUMzQyxTQUFTLE9BQU8sVUFBVTtBQUMxQixXQUFLLE9BQU8sU0FBUyxnQkFBZ0I7QUFDckMsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2hDLENBQUMsQ0FBQztBQUVKLFFBQUkseUJBQVEsV0FBVyxFQUNyQixRQUFRLG1CQUFtQixFQUMzQixXQUFXO0FBRWIsUUFBSSx5QkFBUSxXQUFXLEVBQ3JCLFFBQVEsWUFBWSxFQUNwQixRQUFRLDRDQUE0QyxFQUNwRCxVQUFVLFlBQVUsT0FDbkIsU0FBUyxLQUFLLE9BQU8sU0FBUyxLQUFLLEVBQ25DLFNBQVMsT0FBTyxVQUFVO0FBQzFCLFdBQUssT0FBTyxTQUFTLFFBQVE7QUFDN0IsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ2hDLENBQUMsQ0FBQztBQUdKLFFBQUksS0FBSyxPQUFPLFNBQVMsd0JBQXdCLFVBQVU7QUFDMUQsa0JBQVksUUFBUSxrQkFBa0IsRUFBRSxRQUFRLENBQUMsWUFBWTtBQUFFLGdCQUFRLE1BQU0sVUFBVTtBQUFBLE1BQVMsQ0FBQztBQUNqRyxrQkFBWSxRQUFRLHVCQUF1QixFQUFFLFFBQVEsQ0FBQyxZQUFZO0FBQUUsZ0JBQVEsTUFBTSxVQUFVO0FBQUEsTUFBUSxDQUFDO0FBQUEsSUFDdEcsV0FDUyxLQUFLLE9BQU8sU0FBUyx3QkFBd0IsZUFBZTtBQUNwRSxrQkFBWSxRQUFRLGtCQUFrQixFQUFFLFFBQVEsQ0FBQyxZQUFZO0FBQUUsZ0JBQVEsTUFBTSxVQUFVO0FBQUEsTUFBUSxDQUFDO0FBQ2hHLGtCQUFZLFFBQVEsdUJBQXVCLEVBQUUsUUFBUSxDQUFDLFlBQVk7QUFBRSxnQkFBUSxNQUFNLFVBQVU7QUFBQSxNQUFTLENBQUM7QUFBQSxJQUN2RztBQUFBLEVBQ0Q7QUFDRDsiLAogICJuYW1lcyI6IFtdCn0K
