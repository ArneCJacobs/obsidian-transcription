/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => Transcription
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/transcribe.ts
var import_obsidian2 = require("obsidian");

// src/utils.ts
var import_obsidian = require("obsidian");
var randomString = (length) => Array(length + 1).join((Math.random().toString(36) + "00000000000000000").slice(2, 18)).slice(0, length);
async function payloadGenerator(payload_data) {
  const boundary_string = `Boundary${randomString(16)}`;
  const boundary = `------${boundary_string}`;
  const chunks = [];
  for (const [key, value] of Object.entries(payload_data)) {
    chunks.push(new TextEncoder().encode(`${boundary}\r
`));
    if (typeof value === "string") {
      chunks.push(new TextEncoder().encode(`Content-Disposition: form-data; name="${key}"\r
\r
`));
      chunks.push(new TextEncoder().encode(`${value}\r
`));
    } else if (value instanceof Blob) {
      chunks.push(new TextEncoder().encode(`Content-Disposition: form-data; name="${key}"; filename="blob"\r
Content-Type: "application/octet-stream"\r
\r
`));
      chunks.push(await (0, import_obsidian.getBlobArrayBuffer)(value));
      chunks.push(new TextEncoder().encode("\r\n"));
    } else {
      chunks.push(new Uint8Array(await new Response(value).arrayBuffer()));
      chunks.push(new TextEncoder().encode("\r\n"));
    }
  }
  await Promise.all(chunks);
  chunks.push(new TextEncoder().encode(`${boundary}--\r
`));
  return [await new Blob(chunks).arrayBuffer(), boundary_string];
}

// src/transcribe.ts
var TranscriptionEngine = class {
  constructor(settings, vault) {
    this.transcription_engines = {
      "scribe": this.getTranscriptionScribe,
      "whisper_asr": this.getTranscriptionWhisperASR
    };
    this.settings = settings;
    this.vault = vault;
  }
  segmentsToTimestampedString(segments) {
    var transcription = "";
    const duration_seconds = Math.floor(segments[segments.length - 1].end);
    var start_iso_slice = 14;
    if (duration_seconds >= 3600)
      start_iso_slice = 11;
    for (var s of segments) {
      if (typeof s.start === "number" && typeof s.text === "string") {
        const start = new Date(Math.floor(s.start) * 1e3).toISOString().substring(start_iso_slice, 19);
        const end = new Date(Math.floor(s.end) * 1e3).toISOString().substring(start_iso_slice, 19);
        const timestamp = `\`[${start} - ${end}]\``;
        transcription += timestamp + ": " + s.text + "\n";
      } else {
        if (this.settings.debug)
          console.error(`Invalid segment: ${s}`);
      }
    }
    return transcription;
  }
  async getTranscription(file) {
    if (this.settings.debug)
      console.log(`Transcription engine: ${this.settings.transcription_engine}`);
    this.transcription_engine = this.transcription_engines[this.settings.transcription_engine];
    return this.transcription_engine(file);
  }
  async getTranscriptionWhisperASR(file) {
    let payload_data = {};
    payload_data["audio_file"] = new Blob([await this.vault.readBinary(file)]);
    ;
    const [request_body, boundary_string] = await payloadGenerator(payload_data);
    const options = {
      method: "POST",
      url: `${this.settings.whisperASRUrl}/asr?task=transcribe&language=en`,
      contentType: `multipart/form-data; boundary=----${boundary_string}`,
      body: request_body
    };
    return (0, import_obsidian2.requestUrl)(options).then(async (response) => {
      if (this.settings.debug)
        console.log(response);
      if (this.settings.timestamps)
        return this.segmentsToTimestampedString(response.json.segments);
      else {
        const transcription = response.json.text;
        return transcription;
      }
    }).catch((error) => {
      if (this.settings.debug)
        console.error(error);
      return Promise.reject(error);
    });
  }
  async getTranscriptionScribe(file) {
    let api_base;
    if (this.settings.debug)
      api_base = "https://dev.api.gambitengine.com";
    else
      api_base = "https://api.gambitengine.com";
    const create_transcription_request = {
      method: "POST",
      url: `${api_base}/v1/scribe/transcriptions`,
      headers: { "Authorization": `Bearer ${this.settings.scribeToken}` },
      body: JSON.stringify({ "translate": this.settings.translate })
    };
    if (this.settings.debug)
      console.log("Transcribing with Scribe");
    return (0, import_obsidian2.requestUrl)(create_transcription_request).then(async (response) => {
      const create_transcription_response = response.json;
      if (this.settings.debug)
        console.log(create_transcription_response);
      if (this.settings.debug)
        console.log("Uploading file to Scribe S3...");
      if (create_transcription_response.upload_request === void 0 || create_transcription_response.upload_request.url === void 0 || create_transcription_response.upload_request.fields === void 0) {
        if (this.settings.debug)
          console.error("Scribe returned an invalid upload request");
        return Promise.reject("Scribe returned an invalid upload request");
      }
      let payload_data = {};
      for (const [key, value] of Object.entries(create_transcription_response.upload_request.fields)) {
        if (typeof key === "string" && typeof value === "string")
          payload_data[key] = value;
        else {
          if (this.settings.debug)
            console.error("Scribe returned an invalid upload request");
          return Promise.reject("Scribe returned an invalid upload request");
        }
      }
      payload_data["file"] = new Blob([await this.vault.readBinary(file)]);
      ;
      const [request_body, boundary_string] = await payloadGenerator(payload_data);
      const upload_file_request = {
        method: "POST",
        url: create_transcription_response.upload_request.url,
        contentType: `multipart/form-data; boundary=----${boundary_string}`,
        body: request_body
      };
      return (0, import_obsidian2.requestUrl)(upload_file_request).then(async (response2) => {
        if (this.settings.debug)
          console.log("File uploaded to Scribe S3");
        const get_transcription_request = {
          method: "GET",
          url: `${api_base}/v1/scribe/transcriptions/${create_transcription_response.transcription.transcription_id}`,
          headers: { "Authorization": `Bearer ${this.settings.scribeToken}` }
        };
        if (this.settings.debug)
          console.log("Waiting for Scribe to finish transcribing...");
        let tries = 0;
        while (true) {
          const get_transcription_response = await (0, import_obsidian2.requestUrl)(get_transcription_request).json;
          if (this.settings.debug)
            console.log(get_transcription_response);
          if (get_transcription_response.status == "complete" && get_transcription_response.transcription_text !== void 0 && get_transcription_response.transcription_result !== void 0) {
            if (this.settings.debug)
              console.log("Scribe finished transcribing");
            if (this.settings.timestamps)
              return this.segmentsToTimestampedString(get_transcription_response.transcription_result);
            else
              return get_transcription_response.transcription_text;
          } else if (tries > 60) {
            if (this.settings.debug)
              console.error("Scribe took too long to transcribe the file");
            return Promise.reject("Scribe took too long to transcribe the file");
          } else if (get_transcription_response.status == "failed") {
            if (this.settings.debug)
              console.error("Scribe failed to transcribe the file");
            return Promise.reject("Scribe failed to transcribe the file");
          } else if (get_transcription_response.status == "validation_failed") {
            if (this.settings.debug)
              console.error("Scribe has detected an invalid file");
            return Promise.reject("Scribe has detected an invalid file");
          } else {
            tries += 1;
            await sleep(3e3);
          }
        }
      }).catch((error) => {
        if (this.settings.debug)
          console.error(error);
        return Promise.reject(error);
      });
    }).catch((error) => {
      if (this.settings.debug)
        console.error(error);
      return Promise.reject(error);
    });
  }
};

// src/main.ts
var DEFAULT_SETTINGS = {
  timestamps: false,
  translate: false,
  transcribeFileExtensions: ["mp3", "wav", "webm", "ogg", "flac", "m4a", "aac", "amr", "opus", "aiff", "m3gp", "mp4", "m4v", "mov", "avi", "wmv", "flv", "mpeg", "mpg", "mkv"],
  whisperASRUrl: "http://localhost:9000",
  debug: false,
  scribeToken: "",
  transcription_engine: "Scribe"
};
var _Transcription = class extends import_obsidian3.Plugin {
  async onload() {
    await this.loadSettings();
    _Transcription.plugin = this;
    if (this.settings.debug)
      console.log("Loading Obsidian Transcription");
    this.transcription_engine = new TranscriptionEngine(this.settings, this.app.vault);
    this.addCommand({
      id: "obsidian-transcription-transcribe-all-in-view",
      name: "Transcribe all audio files in view",
      editorCallback: async (editor, view) => {
        const markdownFilePath = view.file.path;
        if (this.settings.debug)
          console.log("Transcribing all audio files in " + markdownFilePath);
        new import_obsidian3.Notice("Transcribing all audio files in " + view.file.name, 3e3);
        const filesLinked = Object.keys(this.app.metadataCache.resolvedLinks[markdownFilePath]);
        console.log(this.app.metadataCache);
        const filesToTranscribe = [];
        for (const linkedFilePath of filesLinked) {
          const linkedFileExtension = linkedFilePath.split(".").pop();
          if (linkedFileExtension === void 0 || !this.settings.transcribeFileExtensions.includes(linkedFileExtension.toLowerCase())) {
            if (this.settings.debug)
              console.log("Skipping " + linkedFilePath + " because the file extension is not in the list of transcribeable file extensions");
            continue;
          }
          const linkedFile = this.app.vault.getAbstractFileByPath(linkedFilePath);
          if (linkedFile instanceof import_obsidian3.TFile)
            filesToTranscribe.push(linkedFile);
          else {
            if (this.settings.debug)
              console.log("Could not find file " + linkedFilePath);
            continue;
          }
        }
        for (const fileToTranscribe of filesToTranscribe) {
          if (this.settings.debug)
            console.log("Transcribing " + fileToTranscribe.path);
          this.transcription_engine.getTranscription(fileToTranscribe).then(async (transcription) => {
            if (this.settings.debug)
              console.log(transcription);
            var fileText = await this.app.vault.read(view.file);
            const fileLinkString = this.app.metadataCache.fileToLinktext(fileToTranscribe, view.file.path);
            const fileLinkStringTagged = `[[${fileLinkString}]]`;
            console.log(fileLinkString);
            const startReplacementIndex = fileText.indexOf(fileLinkStringTagged) + fileLinkStringTagged.length;
            fileText = [fileText.slice(0, startReplacementIndex), `
${transcription}`, fileText.slice(startReplacementIndex)].join("");
            await this.app.vault.modify(view.file, fileText);
          }).catch((error) => {
            if (this.settings.debug)
              new import_obsidian3.Notice("Error transcribing file " + fileToTranscribe.name + ": " + error);
            else
              new import_obsidian3.Notice("Error transcribing file, enable debug mode to see more");
          });
        }
      }
    });
    this.app.workspace.on("quit", () => {
      _Transcription.children.forEach((child) => {
        child.kill();
      });
    });
    this.addSettingTab(new TranscriptionSettingTab(this.app, this));
  }
  onunload() {
    if (this.settings.debug)
      console.log("Unloading Obsidian Transcription");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var Transcription = _Transcription;
Transcription.children = [];
var TranscriptionSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Settings for Obsidian Transcription" });
    new import_obsidian3.Setting(containerEl).setName("General Settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Transcription engine").setDesc("The transcription engine to use").setTooltip("Scribe is a cloud based transcription engine offered by GambitEngine (no set up, mobile friendly). Whisper ASR is a self-hosted local transcription engine that uses the Whisper ASR python app. (requires separate set up, not mobile friendly)").setClass("transcription-engine-setting").addDropdown((dropdown) => dropdown.addOption("scribe", "Scribe").addOption("whisper_asr", "Whisper ASR").setValue(this.plugin.settings.transcription_engine).onChange(async (value) => {
      this.plugin.settings.transcription_engine = value;
      await this.plugin.saveSettings();
      if (value == "scribe") {
        containerEl.findAll(".scribe-settings").forEach((element) => {
          element.style.display = "block";
        });
        containerEl.findAll(".whisper-asr-settings").forEach((element) => {
          element.style.display = "none";
        });
      } else if (value == "whisper_asr") {
        containerEl.findAll(".scribe-settings").forEach((element) => {
          element.style.display = "none";
        });
        containerEl.findAll(".whisper-asr-settings").forEach((element) => {
          element.style.display = "block";
        });
      }
    }));
    new import_obsidian3.Setting(containerEl).setName("Enable timestamps").setDesc("Add timestamps to the beginning of each line").addToggle((toggle) => toggle.setValue(this.plugin.settings.timestamps).onChange(async (value) => {
      this.plugin.settings.timestamps = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Scribe Settings").setClass("scribe-settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Enable translation").setDesc("Translate the transcription from any language to English").setClass("scribe-settings").addToggle((toggle) => toggle.setValue(this.plugin.settings.translate).onChange(async (value) => {
      this.plugin.settings.translate = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Scribe Token").setDesc("The token used to authenticate with the Scribe API. Get one at https://gambitengine.com/scribe").setClass("scribe-settings").addText((text) => text.setPlaceholder(DEFAULT_SETTINGS.scribeToken).setValue(this.plugin.settings.scribeToken).onChange(async (value) => {
      this.plugin.settings.scribeToken = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Whisper ASR Settings").setClass("whisper-asr-settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Whisper ASR URL").setDesc("The URL of the Whisper ASR server: https://github.com/ahmetoner/whisper-asr-webservice").setClass("whisper-asr-settings").addText((text) => text.setPlaceholder(DEFAULT_SETTINGS.whisperASRUrl).setValue(this.plugin.settings.whisperASRUrl).onChange(async (value) => {
      this.plugin.settings.whisperASRUrl = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian3.Setting(containerEl).setName("Advanced Settings").setHeading();
    new import_obsidian3.Setting(containerEl).setName("Debug mode").setDesc("Enable debug mode to see more console logs").addToggle((toggle) => toggle.setValue(this.plugin.settings.debug).onChange(async (value) => {
      this.plugin.settings.debug = value;
      await this.plugin.saveSettings();
    }));
    if (this.plugin.settings.transcription_engine == "scribe") {
      containerEl.findAll(".scribe-settings").forEach((element) => {
        element.style.display = "block";
      });
      containerEl.findAll(".whisper-asr-settings").forEach((element) => {
        element.style.display = "none";
      });
    } else if (this.plugin.settings.transcription_engine == "whisper_asr") {
      containerEl.findAll(".scribe-settings").forEach((element) => {
        element.style.display = "none";
      });
      containerEl.findAll(".whisper-asr-settings").forEach((element) => {
        element.style.display = "block";
      });
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3RyYW5zY3JpYmUudHMiLCAic3JjL3V0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBDaGlsZFByb2Nlc3MgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IEFwcCwgRWRpdG9yLCBNYXJrZG93blZpZXcsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUsIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFRyYW5zY3JpcHRpb25FbmdpbmUgfSBmcm9tICdzcmMvdHJhbnNjcmliZSc7XG5cbmludGVyZmFjZSBUcmFuc2NyaXB0aW9uU2V0dGluZ3Mge1xuXHR0aW1lc3RhbXBzOiBib29sZWFuO1xuXHR0cmFuc2xhdGU6IGJvb2xlYW47XG5cdHRyYW5zY3JpYmVGaWxlRXh0ZW5zaW9uczogc3RyaW5nW107XG5cdHdoaXNwZXJBU1JVcmw6IHN0cmluZztcblx0ZGVidWc6IGJvb2xlYW47XG5cdHNjcmliZVRva2VuOiBzdHJpbmc7XG5cdHRyYW5zY3JpcHRpb25fZW5naW5lOiBzdHJpbmdcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogVHJhbnNjcmlwdGlvblNldHRpbmdzID0ge1xuXHR0aW1lc3RhbXBzOiBmYWxzZSxcblx0dHJhbnNsYXRlOiBmYWxzZSxcblx0dHJhbnNjcmliZUZpbGVFeHRlbnNpb25zOiBbJ21wMycsICd3YXYnLCAnd2VibScsICdvZ2cnLCAnZmxhYycsICdtNGEnLCAnYWFjJywgJ2FtcicsICdvcHVzJywgJ2FpZmYnLCAnbTNncCcsICdtcDQnLCAnbTR2JywgJ21vdicsICdhdmknLCAnd212JywgJ2ZsdicsICdtcGVnJywgJ21wZycsICdta3YnXSxcblx0d2hpc3BlckFTUlVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6OTAwMCcsXG5cdGRlYnVnOiBmYWxzZSxcblx0c2NyaWJlVG9rZW46ICcnLFxuXHR0cmFuc2NyaXB0aW9uX2VuZ2luZTogJ1NjcmliZSdcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNjcmlwdGlvbiBleHRlbmRzIFBsdWdpbiB7XG5cblx0c2V0dGluZ3M6IFRyYW5zY3JpcHRpb25TZXR0aW5ncztcblx0cHVibGljIHN0YXRpYyBwbHVnaW46IFBsdWdpbjtcblx0cHVibGljIHN0YXRpYyBjaGlsZHJlbjogQXJyYXk8Q2hpbGRQcm9jZXNzPiA9IFtdO1xuXHRwdWJsaWMgdHJhbnNjcmlwdGlvbl9lbmdpbmU6IFRyYW5zY3JpcHRpb25FbmdpbmU7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cdFx0VHJhbnNjcmlwdGlvbi5wbHVnaW4gPSB0aGlzO1xuXHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnTG9hZGluZyBPYnNpZGlhbiBUcmFuc2NyaXB0aW9uJyk7XG5cdFx0dGhpcy50cmFuc2NyaXB0aW9uX2VuZ2luZSA9IG5ldyBUcmFuc2NyaXB0aW9uRW5naW5lKHRoaXMuc2V0dGluZ3MsIHRoaXMuYXBwLnZhdWx0KVxuXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnb2JzaWRpYW4tdHJhbnNjcmlwdGlvbi10cmFuc2NyaWJlLWFsbC1pbi12aWV3Jyxcblx0XHRcdG5hbWU6ICdUcmFuc2NyaWJlIGFsbCBhdWRpbyBmaWxlcyBpbiB2aWV3Jyxcblx0XHRcdGVkaXRvckNhbGxiYWNrOiBhc3luYyAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHQvLyBHZXQgdGhlIGN1cnJlbnQgZmlsZXBhdGhcblx0XHRcdFx0Y29uc3QgbWFya2Rvd25GaWxlUGF0aCA9IHZpZXcuZmlsZS5wYXRoO1xuXHRcdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ1RyYW5zY3JpYmluZyBhbGwgYXVkaW8gZmlsZXMgaW4gJyArIG1hcmtkb3duRmlsZVBhdGgpO1xuXHRcdFx0XHRuZXcgTm90aWNlKCdUcmFuc2NyaWJpbmcgYWxsIGF1ZGlvIGZpbGVzIGluICcgKyB2aWV3LmZpbGUubmFtZSwgMzAwMCk7XG5cblx0XHRcdFx0Ly8gR2V0IGFsbCBsaW5rZWQgZmlsZXMgaW4gdGhlIG1hcmtkb3duIGZpbGVcblx0XHRcdFx0Y29uc3QgZmlsZXNMaW5rZWQgPSBPYmplY3Qua2V5cyh0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLnJlc29sdmVkTGlua3NbbWFya2Rvd25GaWxlUGF0aF0pO1xuXHRcdFx0XHRjb25zb2xlLmxvZyh0aGlzLmFwcC5tZXRhZGF0YUNhY2hlKTtcblxuXHRcdFx0XHQvLyBOb3cgdGhhdCB3ZSBoYXZlIGFsbCB0aGUgZmlsZXMgbGlua2VkIGluIHRoZSBtYXJrZG93biBmaWxlLCB3ZSBuZWVkIHRvIGZpbHRlciB0aGVtIGJ5IHRoZSBmaWxlIGV4dGVuc2lvbnMgd2Ugd2FudCB0byB0cmFuc2NyaWJlXG5cdFx0XHRcdGNvbnN0IGZpbGVzVG9UcmFuc2NyaWJlOiBURmlsZVtdID0gW107XG5cdFx0XHRcdGZvciAoY29uc3QgbGlua2VkRmlsZVBhdGggb2YgZmlsZXNMaW5rZWQpIHtcblx0XHRcdFx0XHRjb25zdCBsaW5rZWRGaWxlRXh0ZW5zaW9uID0gbGlua2VkRmlsZVBhdGguc3BsaXQoJy4nKS5wb3AoKTtcblx0XHRcdFx0XHRpZiAobGlua2VkRmlsZUV4dGVuc2lvbiA9PT0gdW5kZWZpbmVkIHx8ICF0aGlzLnNldHRpbmdzLnRyYW5zY3JpYmVGaWxlRXh0ZW5zaW9ucy5pbmNsdWRlcyhsaW5rZWRGaWxlRXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpKSB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ1NraXBwaW5nICcgKyBsaW5rZWRGaWxlUGF0aCArICcgYmVjYXVzZSB0aGUgZmlsZSBleHRlbnNpb24gaXMgbm90IGluIHRoZSBsaXN0IG9mIHRyYW5zY3JpYmVhYmxlIGZpbGUgZXh0ZW5zaW9ucycpO1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gV2Ugbm93IGtub3cgdGhhdCB0aGUgZmlsZSBleHRlbnNpb24gaXMgaW4gdGhlIGxpc3Qgb2YgdHJhbnNjcmliZWFibGUgZmlsZSBleHRlbnNpb25zXG5cdFx0XHRcdFx0Y29uc3QgbGlua2VkRmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChsaW5rZWRGaWxlUGF0aCk7XG5cblx0XHRcdFx0XHQvLyBWYWxpZGF0ZSB0aGF0IHdlIGFyZSBkZWFsaW5nIHdpdGggYSBmaWxlIGFuZCBhZGQgaXQgdG8gdGhlIGxpc3Qgb2YgdmVyaWZpZWQgZmlsZXMgdG8gdHJhbnNjcmliZSBcblx0XHRcdFx0XHRpZiAobGlua2VkRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSBmaWxlc1RvVHJhbnNjcmliZS5wdXNoKGxpbmtlZEZpbGUpO1xuXHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdDb3VsZCBub3QgZmluZCBmaWxlICcgKyBsaW5rZWRGaWxlUGF0aCk7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXG5cdFx0XHRcdC8vIE5vdyB0aGF0IHdlIGhhdmUgYWxsIHRoZSBmaWxlcyB0byB0cmFuc2NyaWJlLCB3ZSBjYW4gdHJhbnNjcmliZSB0aGVtXG5cdFx0XHRcdGZvciAoY29uc3QgZmlsZVRvVHJhbnNjcmliZSBvZiBmaWxlc1RvVHJhbnNjcmliZSkge1xuXHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnVHJhbnNjcmliaW5nICcgKyBmaWxlVG9UcmFuc2NyaWJlLnBhdGgpO1xuXG5cdFx0XHRcdFx0dGhpcy50cmFuc2NyaXB0aW9uX2VuZ2luZS5nZXRUcmFuc2NyaXB0aW9uKGZpbGVUb1RyYW5zY3JpYmUpLnRoZW4oYXN5bmMgKHRyYW5zY3JpcHRpb24pID0+IHtcblx0XHRcdFx0XHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyh0cmFuc2NyaXB0aW9uKTtcblxuXHRcdFx0XHRcdFx0dmFyIGZpbGVUZXh0ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZCh2aWV3LmZpbGUpXG5cdFx0XHRcdFx0XHRjb25zdCBmaWxlTGlua1N0cmluZyA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZmlsZVRvTGlua3RleHQoZmlsZVRvVHJhbnNjcmliZSwgdmlldy5maWxlLnBhdGgpOyAvLyBUaGlzIGlzIHRoZSBzdHJpbmcgdGhhdCBpcyB1c2VkIHRvIGxpbmsgdGhlIGF1ZGlvIGZpbGUgaW4gdGhlIG1hcmtkb3duIGZpbGUuIElmIGZpbGVzIGFyZSBtb3ZlZCB0aGlzIHBvdGVudGlhbGx5IGJyZWFrcywgYnV0IE9ic2lkaWFuIGhhcyBidWlsdC1pbiBoYW5kbGVycyBmb3IgdGhpcywgYW5kIGhhbmRsaW5nIHRoYXQgaXMgb3V0c2lkZSB0aGUgc2NvcGUgb2YgdGhpcyBwbHVnaW5cblx0XHRcdFx0XHRcdGNvbnN0IGZpbGVMaW5rU3RyaW5nVGFnZ2VkID0gYFtbJHtmaWxlTGlua1N0cmluZ31dXWA7IC8vIFRoaXMgaXMgdGhlIHN0cmluZyB0aGF0IGlzIHVzZWQgdG8gbGluayB0aGUgYXVkaW8gZmlsZSBpbiB0aGUgbWFya2Rvd24gZmlsZS5cblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGZpbGVMaW5rU3RyaW5nKVxuXG5cdFx0XHRcdFx0XHQvLyBQZXJmb3JtIGEgc3RyaW5nIHJlcGxhY2VtZW50LCBhZGQgdGhlIHRyYW5zY3JpcHRpb24gdG8gdGhlIG5leHQgbGluZSBhZnRlciB0aGUgZmlsZSBsaW5rXG5cdFx0XHRcdFx0XHRjb25zdCBzdGFydFJlcGxhY2VtZW50SW5kZXggPSBmaWxlVGV4dC5pbmRleE9mKGZpbGVMaW5rU3RyaW5nVGFnZ2VkKSArIGZpbGVMaW5rU3RyaW5nVGFnZ2VkLmxlbmd0aDtcblx0XHRcdFx0XHRcdC8vIGZpbGVUZXh0ID0gW2ZpbGVUZXh0LnNsaWNlKDAsIHN0YXJ0UmVwbGFjZW1lbnRJbmRleCksIGBcXG5cXGBcXGBcXGAke3RyYW5zY3JpcHRpb259XFxgXFxgXFxgYCwgZmlsZVRleHQuc2xpY2Uoc3RhcnRSZXBsYWNlbWVudEluZGV4KV0uam9pbignJyk7XG5cdFx0XHRcdFx0XHRmaWxlVGV4dCA9IFtmaWxlVGV4dC5zbGljZSgwLCBzdGFydFJlcGxhY2VtZW50SW5kZXgpLCBgXFxuJHt0cmFuc2NyaXB0aW9ufWAsIGZpbGVUZXh0LnNsaWNlKHN0YXJ0UmVwbGFjZW1lbnRJbmRleCldLmpvaW4oJycpO1xuXG5cdFx0XHRcdFx0XHQvLyBOb3cgdGhhdCB3ZSBoYXZlIHRoZSBmaWxlIGxpbmVzIHdpdGggdGhlIHRyYW5zY3JpcHRpb24sIHdlIGNhbiB3cml0ZSB0aGUgZmlsZVxuXHRcdFx0XHRcdFx0YXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KHZpZXcuZmlsZSwgZmlsZVRleHQpO1xuXG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgbmV3IE5vdGljZSgnRXJyb3IgdHJhbnNjcmliaW5nIGZpbGUgJyArIGZpbGVUb1RyYW5zY3JpYmUubmFtZSArICc6ICcgKyBlcnJvcik7XG5cdFx0XHRcdFx0XHRlbHNlIG5ldyBOb3RpY2UoJ0Vycm9yIHRyYW5zY3JpYmluZyBmaWxlLCBlbmFibGUgZGVidWcgbW9kZSB0byBzZWUgbW9yZScpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBLaWxsIGNoaWxkIHByb2Nlc3NlcyB3aGVuIHRoZSBwbHVnaW4gaXMgdW5sb2FkZWRcblx0XHR0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJxdWl0XCIsICgpID0+IHtcblx0XHRcdFRyYW5zY3JpcHRpb24uY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcblx0XHRcdFx0Y2hpbGQua2lsbCgpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHQvLyBUaGlzIGFkZHMgYSBzZXR0aW5ncyB0YWIgc28gdGhlIHVzZXIgY2FuIGNvbmZpZ3VyZSB2YXJpb3VzIGFzcGVjdHMgb2YgdGhlIHBsdWdpblxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgVHJhbnNjcmlwdGlvblNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblx0fVxuXG5cdG9udW5sb2FkKCkge1xuXHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZygnVW5sb2FkaW5nIE9ic2lkaWFuIFRyYW5zY3JpcHRpb24nKTtcblx0fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0fVxuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0XHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuXHR9XG59XG5cbmNsYXNzIFRyYW5zY3JpcHRpb25TZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG5cdHBsdWdpbjogVHJhbnNjcmlwdGlvbjtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBUcmFuc2NyaXB0aW9uKSB7XG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHR9XG5cblx0ZGlzcGxheSgpOiB2b2lkIHtcblx0XHRjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ1NldHRpbmdzIGZvciBPYnNpZGlhbiBUcmFuc2NyaXB0aW9uJyB9KTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0dlbmVyYWwgU2V0dGluZ3MnKVxuXHRcdFx0LnNldEhlYWRpbmcoKVxuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnVHJhbnNjcmlwdGlvbiBlbmdpbmUnKVxuXHRcdFx0LnNldERlc2MoJ1RoZSB0cmFuc2NyaXB0aW9uIGVuZ2luZSB0byB1c2UnKVxuXHRcdFx0LnNldFRvb2x0aXAoJ1NjcmliZSBpcyBhIGNsb3VkIGJhc2VkIHRyYW5zY3JpcHRpb24gZW5naW5lIG9mZmVyZWQgYnkgR2FtYml0RW5naW5lIChubyBzZXQgdXAsIG1vYmlsZSBmcmllbmRseSkuIFdoaXNwZXIgQVNSIGlzIGEgc2VsZi1ob3N0ZWQgbG9jYWwgdHJhbnNjcmlwdGlvbiBlbmdpbmUgdGhhdCB1c2VzIHRoZSBXaGlzcGVyIEFTUiBweXRob24gYXBwLiAocmVxdWlyZXMgc2VwYXJhdGUgc2V0IHVwLCBub3QgbW9iaWxlIGZyaWVuZGx5KScpXG5cdFx0XHQuc2V0Q2xhc3MoJ3RyYW5zY3JpcHRpb24tZW5naW5lLXNldHRpbmcnKVxuXHRcdFx0LmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IGRyb3Bkb3duXG5cdFx0XHRcdC5hZGRPcHRpb24oJ3NjcmliZScsICdTY3JpYmUnKVxuXHRcdFx0XHQuYWRkT3B0aW9uKCd3aGlzcGVyX2FzcicsICdXaGlzcGVyIEFTUicpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFuc2NyaXB0aW9uX2VuZ2luZSlcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zY3JpcHRpb25fZW5naW5lID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0Ly8gSGlkZSB0aGUgc2V0dGluZ3MgZm9yIHRoZSBvdGhlciB0cmFuc2NyaXB0aW9uIGVuZ2luZVxuXHRcdFx0XHRcdGlmICh2YWx1ZSA9PSAnc2NyaWJlJykge1xuXHRcdFx0XHRcdFx0Y29udGFpbmVyRWwuZmluZEFsbCgnLnNjcmliZS1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgfSk7XG5cdFx0XHRcdFx0XHRjb250YWluZXJFbC5maW5kQWxsKCcud2hpc3Blci1hc3Itc2V0dGluZ3MnKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7IGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2UgaWYgKHZhbHVlID09ICd3aGlzcGVyX2FzcicpIHtcblx0XHRcdFx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy5zY3JpYmUtc2V0dGluZ3MnKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7IGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSk7XG5cdFx0XHRcdFx0XHRjb250YWluZXJFbC5maW5kQWxsKCcud2hpc3Blci1hc3Itc2V0dGluZ3MnKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7IGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnRW5hYmxlIHRpbWVzdGFtcHMnKVxuXHRcdFx0LnNldERlc2MoJ0FkZCB0aW1lc3RhbXBzIHRvIHRoZSBiZWdpbm5pbmcgb2YgZWFjaCBsaW5lJylcblx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZXN0YW1wcylcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnRpbWVzdGFtcHMgPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnU2NyaWJlIFNldHRpbmdzJylcblx0XHRcdC5zZXRDbGFzcygnc2NyaWJlLXNldHRpbmdzJylcblx0XHRcdC5zZXRIZWFkaW5nKClcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0VuYWJsZSB0cmFuc2xhdGlvbicpXG5cdFx0XHQuc2V0RGVzYygnVHJhbnNsYXRlIHRoZSB0cmFuc2NyaXB0aW9uIGZyb20gYW55IGxhbmd1YWdlIHRvIEVuZ2xpc2gnKVxuXHRcdFx0LnNldENsYXNzKCdzY3JpYmUtc2V0dGluZ3MnKVxuXHRcdFx0LmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFuc2xhdGUpXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFuc2xhdGUgPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnU2NyaWJlIFRva2VuJylcblx0XHRcdC5zZXREZXNjKCdUaGUgdG9rZW4gdXNlZCB0byBhdXRoZW50aWNhdGUgd2l0aCB0aGUgU2NyaWJlIEFQSS4gR2V0IG9uZSBhdCBodHRwczovL2dhbWJpdGVuZ2luZS5jb20vc2NyaWJlJylcblx0XHRcdC5zZXRDbGFzcygnc2NyaWJlLXNldHRpbmdzJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoREVGQVVMVF9TRVRUSU5HUy5zY3JpYmVUb2tlbilcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNjcmliZVRva2VuKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3Muc2NyaWJlVG9rZW4gPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnV2hpc3BlciBBU1IgU2V0dGluZ3MnKVxuXHRcdFx0LnNldENsYXNzKCd3aGlzcGVyLWFzci1zZXR0aW5ncycpXG5cdFx0XHQuc2V0SGVhZGluZygpXG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdXaGlzcGVyIEFTUiBVUkwnKVxuXHRcdFx0LnNldERlc2MoJ1RoZSBVUkwgb2YgdGhlIFdoaXNwZXIgQVNSIHNlcnZlcjogaHR0cHM6Ly9naXRodWIuY29tL2FobWV0b25lci93aGlzcGVyLWFzci13ZWJzZXJ2aWNlJylcblx0XHRcdC5zZXRDbGFzcygnd2hpc3Blci1hc3Itc2V0dGluZ3MnKVxuXHRcdFx0LmFkZFRleHQodGV4dCA9PiB0ZXh0XG5cdFx0XHRcdC5zZXRQbGFjZWhvbGRlcihERUZBVUxUX1NFVFRJTkdTLndoaXNwZXJBU1JVcmwpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy53aGlzcGVyQVNSVXJsKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3Mud2hpc3BlckFTUlVybCA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdBZHZhbmNlZCBTZXR0aW5ncycpXG5cdFx0XHQuc2V0SGVhZGluZygpXG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdEZWJ1ZyBtb2RlJylcblx0XHRcdC5zZXREZXNjKCdFbmFibGUgZGVidWcgbW9kZSB0byBzZWUgbW9yZSBjb25zb2xlIGxvZ3MnKVxuXHRcdFx0LmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWJ1Zylcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYnVnID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblxuXHRcdC8vIEluaXRpYWxseSBoaWRlIHRoZSBzZXR0aW5ncyBmb3IgdGhlIG90aGVyIHRyYW5zY3JpcHRpb24gZW5naW5lXG5cdFx0aWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zY3JpcHRpb25fZW5naW5lID09ICdzY3JpYmUnKSB7XG5cdFx0XHRjb250YWluZXJFbC5maW5kQWxsKCcuc2NyaWJlLXNldHRpbmdzJykuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOyB9KTtcblx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy53aGlzcGVyLWFzci1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9KTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhbnNjcmlwdGlvbl9lbmdpbmUgPT0gJ3doaXNwZXJfYXNyJykge1xuXHRcdFx0Y29udGFpbmVyRWwuZmluZEFsbCgnLnNjcmliZS1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9KTtcblx0XHRcdGNvbnRhaW5lckVsLmZpbmRBbGwoJy53aGlzcGVyLWFzci1zZXR0aW5ncycpLmZvckVhY2goKGVsZW1lbnQpID0+IHsgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgfSk7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCB0eXBlIHsgVHJhbnNjcmlwdGlvblNldHRpbmdzIH07XG4iLCAiaW1wb3J0IHsgVHJhbnNjcmlwdGlvblNldHRpbmdzIH0gZnJvbSBcInNyYy9tYWluXCI7XG5pbXBvcnQgeyByZXF1ZXN0VXJsLCBSZXF1ZXN0VXJsUGFyYW0sIFRGaWxlLCBWYXVsdCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgcGF0aHMsIGNvbXBvbmVudHMgfSBmcm9tIFwiLi90eXBlcy9nYW1iaXRlbmdpbmVcIjtcbmltcG9ydCB7IHBheWxvYWRHZW5lcmF0b3IsIFBheWxvYWREYXRhIH0gZnJvbSBcInNyYy91dGlsc1wiO1xuXG4vLyBUaGlzIGNsYXNzIGlzIHRoZSBwYXJlbnQgZm9yIHRyYW5zY3JpcHRpb24gZW5naW5lcy4gSXQgdGFrZXMgc2V0dGluZ3MgYW5kIGEgZmlsZSBhcyBhbiBpbnB1dCBhbmQgcmV0dXJucyBhIHRyYW5zY3JpcHRpb24gYXMgYSBzdHJpbmdcblxudHlwZSBUcmFuc2NyaXB0aW9uQmFja2VuZCA9IChmaWxlOiBURmlsZSkgPT4gUHJvbWlzZTxzdHJpbmc+O1xuXG5leHBvcnQgY2xhc3MgVHJhbnNjcmlwdGlvbkVuZ2luZSB7XG4gICAgc2V0dGluZ3M6IFRyYW5zY3JpcHRpb25TZXR0aW5ncztcbiAgICB2YXVsdDogVmF1bHQ7XG4gICAgdHJhbnNjcmlwdGlvbl9lbmdpbmU6IFRyYW5zY3JpcHRpb25CYWNrZW5kXG5cbiAgICB0cmFuc2NyaXB0aW9uX2VuZ2luZXM6IHsgW2tleTogc3RyaW5nXTogVHJhbnNjcmlwdGlvbkJhY2tlbmQgfSA9IHtcbiAgICAgICAgXCJzY3JpYmVcIjogdGhpcy5nZXRUcmFuc2NyaXB0aW9uU2NyaWJlLFxuICAgICAgICBcIndoaXNwZXJfYXNyXCI6IHRoaXMuZ2V0VHJhbnNjcmlwdGlvbldoaXNwZXJBU1JcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5nczogVHJhbnNjcmlwdGlvblNldHRpbmdzLCB2YXVsdDogVmF1bHQpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XG4gICAgfVxuXG4gICAgc2VnbWVudHNUb1RpbWVzdGFtcGVkU3RyaW5nKHNlZ21lbnRzOiBjb21wb25lbnRzWydzY2hlbWFzJ11bJ1RyYW5zY3JpcHRpb25SZXN1bHRTZWdtZW50J11bXSk6IHN0cmluZyB7XG4gICAgICAgIHZhciB0cmFuc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlwiO1xuICAgICAgICBjb25zdCBkdXJhdGlvbl9zZWNvbmRzID0gTWF0aC5mbG9vcihzZWdtZW50c1tzZWdtZW50cy5sZW5ndGggLSAxXS5lbmQpO1xuICAgICAgICB2YXIgc3RhcnRfaXNvX3NsaWNlID0gMTQ7XG4gICAgICAgIGlmIChkdXJhdGlvbl9zZWNvbmRzID49IDM2MDApIHN0YXJ0X2lzb19zbGljZSA9IDExO1xuICAgICAgICBmb3IgKHZhciBzIG9mIHNlZ21lbnRzKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHMuc3RhcnQgPT09ICdudW1iZXInICYmIHR5cGVvZiBzLnRleHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgc3RhcnQgYW5kIGVuZCB0aW1lcyB0byBJU08gODYwMSBmb3JtYXQgYW5kIHRoZW4gc3Vic3RyaW5nIHRvIGdldCB0aGUgSEg6TU06U1MgcG9ydGlvblxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoTWF0aC5mbG9vcihzLnN0YXJ0KSAqIDEwMDApLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKHN0YXJ0X2lzb19zbGljZSwgMTkpXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoTWF0aC5mbG9vcihzLmVuZCkgKiAxMDAwKS50b0lTT1N0cmluZygpLnN1YnN0cmluZyhzdGFydF9pc29fc2xpY2UsIDE5KVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IGBcXGBbJHtzdGFydH0gLSAke2VuZH1dXFxgYFxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgdGltZXN0YW1wIGFuZCB0aGUgdGV4dCB0byB0aGUgdHJhbnNjcmlwdGlvblxuICAgICAgICAgICAgICAgIHRyYW5zY3JpcHRpb24gKz0gdGltZXN0YW1wICsgJzogJyArIHMudGV4dCArIFwiXFxuXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKGBJbnZhbGlkIHNlZ21lbnQ6ICR7c31gKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cmFuc2NyaXB0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7VEZpbGV9IGZpbGUgXG4gICAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHRyYW5zY3JpcHRpb24gXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VHJhbnNjcmlwdGlvbihmaWxlOiBURmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyhgVHJhbnNjcmlwdGlvbiBlbmdpbmU6ICR7dGhpcy5zZXR0aW5ncy50cmFuc2NyaXB0aW9uX2VuZ2luZX1gKTtcbiAgICAgICAgdGhpcy50cmFuc2NyaXB0aW9uX2VuZ2luZSA9IHRoaXMudHJhbnNjcmlwdGlvbl9lbmdpbmVzW3RoaXMuc2V0dGluZ3MudHJhbnNjcmlwdGlvbl9lbmdpbmVdO1xuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2NyaXB0aW9uX2VuZ2luZShmaWxlKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUcmFuc2NyaXB0aW9uV2hpc3BlckFTUihmaWxlOiBURmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIC8vIE5vdyB0aGF0IHdlIGhhdmUgdGhlIGZvcm0gZGF0YSBwYXlsb2FkIGFzIGFuIGFycmF5IGJ1ZmZlciwgd2UgY2FuIHBhc3MgaXQgdG8gcmVxdWVzdFVSTFxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gc2V0IHRoZSBjb250ZW50IHR5cGUgdG8gbXVsdGlwYXJ0L2Zvcm0tZGF0YSBhbmQgcGFzcyBpbiB0aGUgQm91bmRhcnkgc3RyaW5nXG5cbiAgICAgICAgbGV0IHBheWxvYWRfZGF0YTogUGF5bG9hZERhdGEgPSB7fVxuICAgICAgICBwYXlsb2FkX2RhdGFbJ2F1ZGlvX2ZpbGUnXSA9IG5ldyBCbG9iKFthd2FpdCB0aGlzLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSldKTs7XG4gICAgICAgIGNvbnN0IFtyZXF1ZXN0X2JvZHksIGJvdW5kYXJ5X3N0cmluZ10gPSBhd2FpdCBwYXlsb2FkR2VuZXJhdG9yKHBheWxvYWRfZGF0YSk7XG5cbiAgICAgICAgY29uc3Qgb3B0aW9uczogUmVxdWVzdFVybFBhcmFtID0ge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6IGAke3RoaXMuc2V0dGluZ3Mud2hpc3BlckFTUlVybH0vYXNyP3Rhc2s9dHJhbnNjcmliZSZsYW5ndWFnZT1lbmAsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogYG11bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0ke2JvdW5kYXJ5X3N0cmluZ31gLFxuICAgICAgICAgICAgYm9keTogcmVxdWVzdF9ib2R5XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmwob3B0aW9ucykudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgICAgICAgICAgIC8vIFdoaXNwZXJBU1IgcmV0dXJucyBhIEpTT04gb2JqZWN0IHdpdGggYSB0ZXh0IGZpZWxkIGNvbnRhaW5pbmcgdGhlIHRyYW5zY3JpcHRpb24gYW5kIHNlZ21lbnRzIGZpZWxkXG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy50aW1lc3RhbXBzKSByZXR1cm4gdGhpcy5zZWdtZW50c1RvVGltZXN0YW1wZWRTdHJpbmcocmVzcG9uc2UuanNvbi5zZWdtZW50cyk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2NyaXB0aW9uOiBzdHJpbmcgPSByZXNwb25zZS5qc29uLnRleHQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHJhbnNjcmlwdGlvblNjcmliZShmaWxlOiBURmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIC8vIERlY2xhcmUgY29uc3RhbnRzIGZvciB0aGUgU2NyaWJlIEFQSVxuICAgICAgICBsZXQgYXBpX2Jhc2U6IHN0cmluZ1xuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgYXBpX2Jhc2UgPSAnaHR0cHM6Ly9kZXYuYXBpLmdhbWJpdGVuZ2luZS5jb20nXG4gICAgICAgIGVsc2UgYXBpX2Jhc2UgPSAnaHR0cHM6Ly9hcGkuZ2FtYml0ZW5naW5lLmNvbSdcblxuICAgICAgICBjb25zdCBjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXF1ZXN0OiBSZXF1ZXN0VXJsUGFyYW0gPSB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogYCR7YXBpX2Jhc2V9L3YxL3NjcmliZS90cmFuc2NyaXB0aW9uc2AsXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuc2V0dGluZ3Muc2NyaWJlVG9rZW59YCB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyAndHJhbnNsYXRlJzogdGhpcy5zZXR0aW5ncy50cmFuc2xhdGUgfSksXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coXCJUcmFuc2NyaWJpbmcgd2l0aCBTY3JpYmVcIik7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgdHJhbnNjcmlwdGlvbiByZXF1ZXN0LCB0aGVuIHVwbG9hZCB0aGUgZmlsZSB0byBTY3JpYmUgUzNcbiAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmwoY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVxdWVzdCkudGhlbihhc3luYyAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZV90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlOiBwYXRoc1snL3YxL3NjcmliZS90cmFuc2NyaXB0aW9ucyddWydwb3N0J11bJ3Jlc3BvbnNlcyddWycyMDEnXVsnY29udGVudCddWydhcHBsaWNhdGlvbi9qc29uJ10gPSByZXNwb25zZS5qc29uO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdVcGxvYWRpbmcgZmlsZSB0byBTY3JpYmUgUzMuLi4nKTtcblxuICAgICAgICAgICAgaWYgKGNyZWF0ZV90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlLnVwbG9hZF9yZXF1ZXN0ID09PSB1bmRlZmluZWQgfHwgY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudXBsb2FkX3JlcXVlc3QudXJsID09PSB1bmRlZmluZWQgfHwgY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudXBsb2FkX3JlcXVlc3QuZmllbGRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5lcnJvcignU2NyaWJlIHJldHVybmVkIGFuIGludmFsaWQgdXBsb2FkIHJlcXVlc3QnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1NjcmliZSByZXR1cm5lZCBhbiBpbnZhbGlkIHVwbG9hZCByZXF1ZXN0Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgZm9ybSBkYXRhIHBheWxvYWRcbiAgICAgICAgICAgIGxldCBwYXlsb2FkX2RhdGE6IFBheWxvYWREYXRhID0ge31cblxuICAgICAgICAgICAgLy8gQWRkIHRoZSB1cGxvYWQgcmVxdWVzdCBkYXRhIGZvciB0aGUgUzMgcHJlc2lnbmVkIFVSTCBmcm9tIFNjcmliZVxuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudXBsb2FkX3JlcXVlc3QuZmllbGRzKSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSBwYXlsb2FkX2RhdGFba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5lcnJvcignU2NyaWJlIHJldHVybmVkIGFuIGludmFsaWQgdXBsb2FkIHJlcXVlc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdTY3JpYmUgcmV0dXJuZWQgYW4gaW52YWxpZCB1cGxvYWQgcmVxdWVzdCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIHRoZSBtZWRpYSBmaWxlXG4gICAgICAgICAgICBwYXlsb2FkX2RhdGFbJ2ZpbGUnXSA9IG5ldyBCbG9iKFthd2FpdCB0aGlzLnZhdWx0LnJlYWRCaW5hcnkoZmlsZSldKTs7XG5cbiAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIHJlcXVlc3QgdG8gYW4gYXJyYXkgYnVmZmVyXG4gICAgICAgICAgICBjb25zdCBbcmVxdWVzdF9ib2R5LCBib3VuZGFyeV9zdHJpbmddID0gYXdhaXQgcGF5bG9hZEdlbmVyYXRvcihwYXlsb2FkX2RhdGEpO1xuXG4gICAgICAgICAgICBjb25zdCB1cGxvYWRfZmlsZV9yZXF1ZXN0OiBSZXF1ZXN0VXJsUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBjcmVhdGVfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS51cGxvYWRfcmVxdWVzdC51cmwsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGBtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tJHtib3VuZGFyeV9zdHJpbmd9YCxcbiAgICAgICAgICAgICAgICBib2R5OiByZXF1ZXN0X2JvZHlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVjb2RlIHVwbG9hZCBmaWxlIHJlcXVlc3QgYW5kIGxvZyBpdFxuICAgICAgICAgICAgLy8gaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIC8vICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coZGVjb2Rlci5kZWNvZGUocmVxdWVzdF9ib2R5KSk7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIC8vIFVwbG9hZCB0aGUgZmlsZSB0byBTY3JpYmUgUzNcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0VXJsKHVwbG9hZF9maWxlX3JlcXVlc3QpLnRoZW4oYXN5bmMgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdGaWxlIHVwbG9hZGVkIHRvIFNjcmliZSBTMycpO1xuXG4gICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgU2NyaWJlIHRvIGZpbmlzaCB0cmFuc2NyaWJpbmcgdGhlIGZpbGVcblxuICAgICAgICAgICAgICAgIGNvbnN0IGdldF90cmFuc2NyaXB0aW9uX3JlcXVlc3Q6IFJlcXVlc3RVcmxQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHthcGlfYmFzZX0vdjEvc2NyaWJlL3RyYW5zY3JpcHRpb25zLyR7Y3JlYXRlX3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudHJhbnNjcmlwdGlvbi50cmFuc2NyaXB0aW9uX2lkfWAsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5zZXR0aW5ncy5zY3JpYmVUb2tlbn1gIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coJ1dhaXRpbmcgZm9yIFNjcmliZSB0byBmaW5pc2ggdHJhbnNjcmliaW5nLi4uJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBQb2xsIFNjcmliZSB1bnRpbCB0aGUgdHJhbnNjcmlwdGlvbiBpcyBjb21wbGV0ZVxuICAgICAgICAgICAgICAgIGxldCB0cmllcyA9IDA7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSB0cmFuc2NyaXB0aW9uIHN0YXR1c1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZTogcGF0aHNbJy92MS9zY3JpYmUvdHJhbnNjcmlwdGlvbnMve3RyYW5zY3JpcHRpb25faWR9J11bJ2dldCddWydyZXNwb25zZXMnXVsnMjAwJ11bJ2NvbnRlbnQnXVsnYXBwbGljYXRpb24vanNvbiddID0gYXdhaXQgcmVxdWVzdFVybChnZXRfdHJhbnNjcmlwdGlvbl9yZXF1ZXN0KS5qc29uO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5kZWJ1ZykgY29uc29sZS5sb2coZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0cmFuc2NyaXB0aW9uIGlzIGNvbXBsZXRlLCByZXR1cm4gdGhlIHRyYW5zY3JpcHRpb24gdGV4dFxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2Uuc3RhdHVzID09ICdjb21wbGV0ZScgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldF90cmFuc2NyaXB0aW9uX3Jlc3BvbnNlLnRyYW5zY3JpcHRpb25fdGV4dCAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS50cmFuc2NyaXB0aW9uX3Jlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZGsgaG93IGFzc2VydHMgd29yayBpbiBKUywgYnV0IHRoaXMgc2hvdWxkIGJlIGFuIGFzc2VydFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUubG9nKCdTY3JpYmUgZmluaXNoZWQgdHJhbnNjcmliaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy50aW1lc3RhbXBzKSByZXR1cm4gdGhpcy5zZWdtZW50c1RvVGltZXN0YW1wZWRTdHJpbmcoZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudHJhbnNjcmlwdGlvbl9yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2UudHJhbnNjcmlwdGlvbl90ZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRyaWVzID4gNjApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKCdTY3JpYmUgdG9vayB0b28gbG9uZyB0byB0cmFuc2NyaWJlIHRoZSBmaWxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1NjcmliZSB0b29rIHRvbyBsb25nIHRvIHRyYW5zY3JpYmUgdGhlIGZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChnZXRfdHJhbnNjcmlwdGlvbl9yZXNwb25zZS5zdGF0dXMgPT0gJ2ZhaWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKCdTY3JpYmUgZmFpbGVkIHRvIHRyYW5zY3JpYmUgdGhlIGZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnU2NyaWJlIGZhaWxlZCB0byB0cmFuc2NyaWJlIHRoZSBmaWxlJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZ2V0X3RyYW5zY3JpcHRpb25fcmVzcG9uc2Uuc3RhdHVzID09ICd2YWxpZGF0aW9uX2ZhaWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSBjb25zb2xlLmVycm9yKCdTY3JpYmUgaGFzIGRldGVjdGVkIGFuIGludmFsaWQgZmlsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdTY3JpYmUgaGFzIGRldGVjdGVkIGFuIGludmFsaWQgZmlsZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0cmFuc2NyaXB0aW9uIGlzIHN0aWxsIGluIHByb2dyZXNzLCB3YWl0IDMgc2Vjb25kcyBhbmQgdHJ5IGFnYWluXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJpZXMgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNsZWVwKDMwMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWcpIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwgIi8qIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBPYnNpZGlhbiBUcmFuc2NyaXB0ICovXG5pbXBvcnQgeyBBcHAsIEZpbGVTeXN0ZW1BZGFwdGVyLCBURmlsZSwgVmF1bHQsIGdldEJsb2JBcnJheUJ1ZmZlciB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY29uc3QgcmFuZG9tU3RyaW5nID0gKGxlbmd0aDogbnVtYmVyKSA9PiBBcnJheShsZW5ndGggKyAxKS5qb2luKChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KSArICcwMDAwMDAwMDAwMDAwMDAwMCcpLnNsaWNlKDIsIDE4KSkuc2xpY2UoMCwgbGVuZ3RoKVxuZXhwb3J0IGNvbnN0IGdldEFsbExpbmVzRnJvbUZpbGUgPSAoY2FjaGU6IHN0cmluZykgPT4gY2FjaGUuc3BsaXQoL1xccj9cXG4vKVxuZXhwb3J0IGNvbnN0IGNvbWJpbmVGaWxlTGluZXMgPSAobGluZXM6IHN0cmluZ1tdKSA9PiBsaW5lcy5qb2luKFwiXFxuXCIpXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRWYXVsdEFic29sdXRlUGF0aChhcHA6IEFwcCkge1xuICAgIC8vIE9yaWdpbmFsIGNvZGUgd2FzIGNvcGllZCAyMDIxLTA4LTIyIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL3BoaWJyMC9vYnNpZGlhbi1vcGVuLXdpdGgvYmxvYi84NGYwZTI1YmE4ZTgzNTVmZjgzYjIyZjQwNTBhZGRlNGNjNjc2M2VhL21haW4udHMjTDY2LUw2N1xuICAgIC8vIEJ1dCB0aGUgY29kZSBoYXMgYmVlbiByZXdyaXR0ZW4gMjAyMS0wOC0yNyBhcyBwZXIgaHR0cHM6Ly9naXRodWIuY29tL29ic2lkaWFubWQvb2JzaWRpYW4tcmVsZWFzZXMvcHVsbC80MzMjaXNzdWVjb21tZW50LTkwNjA4NzA5NVxuICAgIGNvbnN0IGFkYXB0ZXIgPSBhcHAudmF1bHQuYWRhcHRlcjtcbiAgICBpZiAoYWRhcHRlciBpbnN0YW5jZW9mIEZpbGVTeXN0ZW1BZGFwdGVyKSB7XG4gICAgICAgIHJldHVybiBhZGFwdGVyLmdldEJhc2VQYXRoKCk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuXG50eXBlIFBheWxvYWRBbmRCb3VuZGFyeSA9IFtBcnJheUJ1ZmZlciwgc3RyaW5nXTtcblxuXG5leHBvcnQgdHlwZSBQYXlsb2FkRGF0YSA9IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIHwgQmxvYiB8IEFycmF5QnVmZmVyIH1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBheWxvYWRHZW5lcmF0b3IocGF5bG9hZF9kYXRhOiBQYXlsb2FkRGF0YSk6IFByb21pc2U8UGF5bG9hZEFuZEJvdW5kYXJ5PiB7XG4gICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBhIHdvcmthcm91bmQgdG8gY3VycmVudCBPYnNpZGlhbiBBUEkgbGltaXRhdGlvbnM6IHJlcXVlc3RVUkwgb25seSBzdXBwb3J0cyBzdHJpbmcgZGF0YSBvciBhbiB1bm5hbWVkIGJsb2IsIG5vdCBrZXktdmFsdWUgZm9ybWRhdGFcbiAgICAvLyBFc3NlbnRpYWxseSB3aGF0IHdlJ3JlIGRvaW5nIGhlcmUgaXMgY29uc3RydWN0aW5nIGEgbXVsdGlwYXJ0L2Zvcm0tZGF0YSBwYXlsb2FkIG1hbnVhbGx5IGFzIGEgc3RyaW5nIGFuZCB0aGVuIHBhc3NpbmcgaXQgdG8gcmVxdWVzdFVSTFxuXG4gICAgY29uc3QgYm91bmRhcnlfc3RyaW5nID0gYEJvdW5kYXJ5JHtyYW5kb21TdHJpbmcoMTYpfWA7XG4gICAgY29uc3QgYm91bmRhcnkgPSBgLS0tLS0tJHtib3VuZGFyeV9zdHJpbmd9YDtcbiAgICAvLyBjb25zdCBjaHVua3M6IFVpbnQ4QXJyYXkgfCBBcnJheUJ1ZmZlcltdID0gW107XG4gICAgY29uc3QgY2h1bmtzOiBhbnlbXSA9IFtdO1xuICAgIC8vIGF3YWl0IHBheWxvYWRfZGF0YS5mb3JFYWNoKGFzeW5jICh2YWx1ZSwga2V5KSA9PiB7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocGF5bG9hZF9kYXRhKSkge1xuICAgICAgICAvLyBTdGFydCBvZiBhIG5ldyBwYXJ0XG4gICAgICAgIGNodW5rcy5wdXNoKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHtib3VuZGFyeX1cXHJcXG5gKSk7XG5cbiAgICAgICAgLy8gSWYgdGhlIHZhbHVlIGlzIGEgc3RyaW5nLCB0aGVuIGl0J3MgYSBrZXktdmFsdWUgcGFpclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGBDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9XCIke2tleX1cIlxcclxcblxcclxcbmApKTtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgJHt2YWx1ZX1cXHJcXG5gKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBCbG9iKSB7XG4gICAgICAgICAgICBjaHVua3MucHVzaChuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYENvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT1cIiR7a2V5fVwiOyBmaWxlbmFtZT1cImJsb2JcIlxcclxcbkNvbnRlbnQtVHlwZTogXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIlxcclxcblxcclxcbmApKTtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKGF3YWl0IGdldEJsb2JBcnJheUJ1ZmZlcih2YWx1ZSkpO1xuICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCdcXHJcXG4nKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjaHVua3MucHVzaChuZXcgVWludDhBcnJheShhd2FpdCBuZXcgUmVzcG9uc2UodmFsdWUpLmFycmF5QnVmZmVyKCkpKTtcbiAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgnXFxyXFxuJykpO1xuICAgICAgICB9XG5cbiAgICB9XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoY2h1bmtzKTtcbiAgICBjaHVua3MucHVzaChuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYCR7Ym91bmRhcnl9LS1cXHJcXG5gKSk7XG4gICAgcmV0dXJuIFthd2FpdCBuZXcgQmxvYihjaHVua3MpLmFycmF5QnVmZmVyKCksIGJvdW5kYXJ5X3N0cmluZ107XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsdUJBQTRGOzs7QUNBNUYsdUJBQTBEOzs7QUNBMUQsc0JBQXlFO0FBRWxFLElBQU0sZUFBZSxDQUFDLFdBQW1CLE1BQU0sU0FBUyxDQUFDLEVBQUUsS0FBTSxNQUFLLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxxQkFBcUIsTUFBTSxHQUFHLEVBQUUsQ0FBQyxFQUFFLE1BQU0sR0FBRyxNQUFNO0FBbUJ2SixnQ0FBdUMsY0FBd0Q7QUFJM0YsUUFBTSxrQkFBa0IsV0FBVyxhQUFhLEVBQUU7QUFDbEQsUUFBTSxXQUFXLFNBQVM7QUFFMUIsUUFBTSxTQUFnQixDQUFDO0FBRXZCLGFBQVcsQ0FBQyxLQUFLLFVBQVUsT0FBTyxRQUFRLFlBQVksR0FBRztBQUVyRCxXQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyxHQUFHO0FBQUEsQ0FBYyxDQUFDO0FBR3ZELFFBQUksT0FBTyxVQUFVLFVBQVU7QUFDM0IsYUFBTyxLQUFLLElBQUksWUFBWSxFQUFFLE9BQU8seUNBQXlDO0FBQUE7QUFBQSxDQUFjLENBQUM7QUFDN0YsYUFBTyxLQUFLLElBQUksWUFBWSxFQUFFLE9BQU8sR0FBRztBQUFBLENBQVcsQ0FBQztBQUFBLElBQ3hELFdBQ1MsaUJBQWlCLE1BQU07QUFDNUIsYUFBTyxLQUFLLElBQUksWUFBWSxFQUFFLE9BQU8seUNBQXlDO0FBQUE7QUFBQTtBQUFBLENBQTJFLENBQUM7QUFDMUosYUFBTyxLQUFLLE1BQU0sd0NBQW1CLEtBQUssQ0FBQztBQUMzQyxhQUFPLEtBQUssSUFBSSxZQUFZLEVBQUUsT0FBTyxNQUFNLENBQUM7QUFBQSxJQUNoRCxPQUNLO0FBQ0QsYUFBTyxLQUFLLElBQUksV0FBVyxN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
